<!DOCTYPE html>
<html lang="zh" style="height:100%">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>è‡³å…ƒå¾·è¯­ - é€ å¥ç»ƒä¹ å™¨ A1-1</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;touch-action:manipulation;-webkit-text-size-adjust:100%;text-size-adjust:100%}
html,body{width:100%;height:100%;min-height:100vh;overflow-x:hidden}
body{background:linear-gradient(135deg,rgba(26,42,108,0.9),rgba(178,31,31,0.9),rgba(26,42,108,0.9));background-repeat:no-repeat;background-size:cover;background-position:center;color:#333;line-height:1.6;padding:12px;min-height:100vh;display:flex;flex-direction:column}
.container{max-width:1200px;margin:0 auto;padding:12px;flex:1}
header{display:flex;flex-direction:column;justify-content:space-between;color:white;text-shadow:0 2px 4px rgba(0,0,0,0.3);margin-bottom:12px;padding:10px 0}
.header-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.header-title{flex:1;min-width:0;max-width:100%}
h1{font-size:1.4rem;margin-bottom:4px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:100%}
.tool-description{background:rgba(255,255,255,0.2);border-radius:8px;padding:8px;font-size:0.85rem;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;line-height:1.4;max-height:3.2em;width:100%}
.mode-container{display:flex;flex-direction:column;min-width:150px}
.mode-title{font-weight:bold;font-size:0.95rem;opacity:0.9;margin-bottom:6px;text-align:right;white-space:nowrap}
.mode-selector{display:flex;gap:6px;width:100%}
.mode-btn{height:32px;line-height:32px;padding:0 10px;border-radius:18px;border:2px solid #ffcc00;color:#ffcc00;background:rgba(255,255,255,0.1);cursor:pointer;font-weight:bold;font-size:0.9rem;display:flex;align-items:center;justify-content:center;flex:1;min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:all 0.3s ease}
.mode-btn.active{background:#ffcc00;color:#1a2a6c}
.mode-btn:hover{background:rgba(255,204,0,0.3)}
.main-content{display:flex;flex-direction:column;gap:16px}
.exercise-section,.theory-section{background:rgba(255,255,255,0.92);border-radius:12px;padding:16px;box-shadow:0 5px 15px rgba(0,0,0,0.15)}
.section-title{font-size:1.3rem;color:#1a2a6c;margin-bottom:12px;border-bottom:2px solid #1a2a6c;text-align:center;padding-bottom:8px;position:relative}
.puzzle-container-wrapper{margin-top:18px;position:relative}
.puzzle-container{display:flex;flex-wrap:wrap;gap:11px;margin:0;justify-content:center}
.puzzle-slot{flex:0 0 auto;min-width:104px;max-width:138px;height:50px;border:2px dashed #1a2a6c;border-radius:8px;padding:2px;background:#f8f9fa;position:relative;text-align:center;display:flex;align-items:center;justify-content:center;margin-bottom:22px}
.puzzle-slot.punctuation-slot{min-width:90px;max-width:120px}
.puzzle-slot::before{content:attr(data-label);position:absolute;top:-24px;left:50%;transform:translateX(-50%);background:#1a2a6c;color:white;font-size:0.8rem;padding:3px 8px;border-radius:8px;white-space:nowrap;z-index:10}
.word-bank{display:flex;flex-wrap:wrap;gap:8px;margin:0;justify-content:center;min-height:70px;padding:9px 10px;background:rgba(0,0,0,0.03);border-radius:8px;transition:background 0.3s}
.word-bank.active{background:rgba(255,204,0,0.1)}
.puzzle-piece{background:#e3f2fd;padding:8px 12px;border-radius:6px;font-weight:bold;cursor:move;min-width:70px;text-align:center;height:40px;display:flex;align-items:center;justify-content:center;font-size:0.95rem;box-shadow:0 2px 4px rgba(0,0,0,0.1);user-select:none;-webkit-tap-highlight-color:transparent;position:relative;transition:all 0.2s ease}
.puzzle-piece:hover{transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.15)}
.puzzle-slot>.puzzle-piece{width:100%;height:100%;display:flex;align-items:center;justify-content:center;padding:0;min-width:auto;box-shadow:none}
.puzzle-piece.punctuation{background:#d7ccc8}
.puzzle-piece.empty-slot{background:#e3f2fd;border:none}
.puzzle-piece.empty-slot::after{content:""}
.controls{display:flex;flex-wrap:wrap;justify-content:center;gap:8px;margin-top:16px;position:relative}
.btn{padding:8px 14px;border-radius:8px;font-weight:bold;cursor:pointer;border:none;display:flex;align-items:center;justify-content:center;transition:all 0.2s ease;font-size:0.95rem;min-width:95px;flex:1;max-width:143px}
.btn-secondary{background:#6c757d;color:white}
.btn-secondary:hover{background:#5a6268}
.btn-success{background:#28a745;color:white}
.btn-success:hover{background:#218838}
.btn-submit{background:#ffcc00;color:#1a2a6c;font-weight:bold;min-width:132px;max-width:165px}
.btn-submit:hover{background:#e6b800}
.feedback{margin-top:16px;padding:12px;border-radius:8px;display:block;background:#d4edda;color:#155724;border:2px solid #c3e6cb;animation:fadeIn 0.5s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.feedback-header{display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;margin-bottom:12px;gap:8px}
.feedback-title{font-size:1.2rem;color:#1a2a6c;font-weight:bold;flex:1;min-width:150px}
.current-score-container{font-size:1.3rem;font-weight:bold;min-width:100px;text-align:right}
.current-score-container.high{color:#28a745}
.current-score-container.low{color:#dc3545}
.score-details{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:12px}
.score-item{background:rgba(255,255,255,0.7);padding:8px;border-radius:8px;text-align:center}
.score-value{font-size:1.1rem;font-weight:bold;color:#1a2a6c;display:block;margin-top:4px}
.score-item.error .score-value{color:#dc3545}
.reference-answer{text-align:center;font-size:1.1rem;font-weight:bold;margin:12px 0;padding:8px;background:rgba(255,255,255,0.7);border-radius:8px;border-left:4px solid #1a2a6c}
.vocab-section{margin-bottom:8px;padding:2px;border-radius:8px}
.vocab-container{display:flex;flex-wrap:wrap;gap:6px;justify-content:center}
.vocab-item{background:white;padding:6px 10px;border-radius:5px;font-size:0.9rem;font-weight:500;color:#1a2a6c;min-width:80px;text-align:center;box-shadow:0 1px 3px rgba(0,0,0,0.1);flex:1;transition:transform 0.2s}
.vocab-item:hover{transform:scale(1.05)}
.copyright{text-align:center;font-size:0.85rem;margin-top:20px;padding:10px 15px;background:rgba(255,255,255,0.25);border-radius:8px;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,0.3);box-shadow:0 2px 6px rgba(0,0,0,0.2)}
.theory-card{background:#f8f9fa;border-radius:8px;padding:12px;margin-top:12px;border:1px solid #ddd;box-shadow:0 2px 5px rgba(0,0,0,0.05);font-size:0.95rem;width:100%}
.theory-card ul{padding-left:20px;margin:12px 0}
.theory-card li{margin-bottom:6px;line-height:1.5}
.theory-card li li{font-size:0.9em;line-height:1.4}
.advanced-tip{position:fixed;top:70px;left:50%;transform:translateX(-50%);background:rgba(255,255,255,0.9);color:#1a2a6c;padding:8px 16px;border-radius:30px;box-shadow:0 4px 10px rgba(0,0,0,0.2);z-index:1000;opacity:0;transition:opacity 0.5s ease-in-out;pointer-events:none;font-weight:bold;max-width:90%;text-align:center;font-size:0.95rem}
.advanced-tip.show{opacity:1}
.btn-icon{margin-left:6px;font-size:1.05em}
.sentence-info{display:flex;flex-wrap:wrap;justify-content:center;align-items:center;margin-bottom:0;padding:10px;background:#e3f2fd;border-radius:8px;font-size:1rem;font-weight:bold;color:#1a2a6c;text-align:center}
.translation-text{text-decoration:underline;text-decoration-thickness:1.5px;text-underline-offset:3px;margin-left:4px;font-weight:bold;display:inline-block;margin-top:4px;flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis}
.next-button-warning{position:absolute;top:-32px;left:50%;transform:translateX(-50%);background:#dc3545;color:white;padding:5px 12px;border-radius:20px;font-size:0.85rem;opacity:0;transition:opacity 0.3s ease;white-space:nowrap;pointer-events:none;width:max-content;max-width:90%}
.next-button-warning.show{opacity:1}
.reading-indicator{display:flex;gap:6px;align-items:center;justify-content:center;margin-top:0;position:absolute;right:12px;top:calc(50% - 15px);transform:translateY(-50%);pointer-events:none;z-index:1001}
.reading-dot{width:10px;height:10px;border-radius:50%;background:#bbb;transition:background .18s,box-shadow .18s}
.reading-indicator.speaking .dot1{animation:dot1Anim 1.2s linear infinite}
.reading-indicator.speaking .dot2{animation:dot2Anim 1.2s linear infinite}
.reading-indicator.speaking .dot3{animation:dot3Anim 1.2s linear infinite}
@keyframes dot1Anim{0%,100%{background:#4CAF50;box-shadow:0 0 8px rgba(76,175,80,0.95)}25%,50%,75%{background:#bbb;box-shadow:none}}
@keyframes dot2Anim{25%,75%{background:#4CAF50;box-shadow:0 0 8px rgba(76,175,80,0.95)}0%,50%,100%{background:#bbb;box-shadow:none}}
@keyframes dot3Anim{50%{background:#4CAF50;box-shadow:0 0 8px rgba(76,175,80,0.95)}0%,25%,75%,100%{background:#bbb;box-shadow:none}}
.file-upload-container{background:rgba(255,255,255,0.92);border-radius:12px;padding:16px;margin-top:16px;box-shadow:0 5px 15px rgba(0,0,0,0.15)}
.file-upload-header{display:flex;align-items:center;margin-bottom:12px;flex-wrap:wrap;gap:10px}
.file-upload-btn{background:#1a2a6c;color:white;padding:8px 16px;border-radius:8px;cursor:pointer;font-weight:bold;display:inline-flex;align-items:center;min-width:150px;justify-content:center;border:none;transition:background 0.2s}
.file-upload-btn:hover{background:#0e1a4a}
.file-upload-btn svg{margin-right:8px}
.file-name{margin-left:12px;font-size:0.9rem;color:#666;flex:1;min-width:200px}
.upload-status{margin-top:12px;padding:10px;border-radius:8px;text-align:center;font-weight:bold;display:none}
.upload-status.success{background:#d4edda;color:#155724;border:1px solid #c3e6cb;display:block}
.upload-status.error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb;display:block}
.sentence-puzzle-header{position:relative;padding-bottom:6px}
@media (max-width:767px){.puzzle-piece{cursor:pointer}.puzzle-slot.filled{cursor:pointer}.puzzle-slot.filled .puzzle-piece{transform:scale(1.05);box-shadow:0 0 10px rgba(0,0,0,0.2)}.puzzle-slot.filled .puzzle-piece:hover{transform:scale(1.1);box-shadow:0 0 15px rgba(0,0,0,0.3)}.mobile-tip{display:block;text-align:center;font-size:0.85rem;color:#1a2a6c;background:rgba(255,255,255,0.4);padding:6px;border-radius:6px;margin-top:8px}.upload-status{max-width:48%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.upload-status-container{width:100%;display:flex;justify-content:flex-end}.vocab-item{max-width:100%;word-break:break-word;overflow-wrap:anywhere;font-size:0.8rem}.vocab-item.long{font-size:0.75rem}.container{max-width:100%;width:100%;margin:0;padding:12px}.header-grid{grid-template-columns:1fr;grid-template-areas:"left";gap:10px}.header-right{margin-top:10px}.mode-selector{flex-direction:row;gap:8px}.mode-btn{font-size:0.9rem;padding:6px 12px}.upload-row{flex-direction:column;gap:8px}.upload-controls{flex-direction:column;gap:8px;min-width:100%}.file-upload-btn{font-size:0.85rem;padding:6px 10px;min-width:120px}.corpus-hint{width:100%;font-size:0.8rem;padding:6px}.upload-status-container{justify-content:center}}
@media (min-width:768px){.mobile-tip{display:none}.container{padding:20px}header{flex-direction:row;align-items:flex-end;padding:0;margin-bottom:20px}.header-top{flex-direction:row;align-items:flex-end;margin-bottom:0}.header-title{margin-right:20px;max-width:calc(100% - 200px)}h1{font-size:1.8rem;max-width:100%}.tool-description{font-size:0.95rem;padding:10px;max-height:none;-webkit-line-clamp:unset;max-width:100%}.mode-container{min-width:180px}.mode-title{font-size:1.05rem}.mode-btn{font-size:1rem;height:36px}.main-content{display:grid;grid-template-columns:1fr 350px;gap:20px}.section-title{font-size:1.5rem}.puzzle-container{justify-content:center;gap:11px}.puzzle-slot{min-width:115px;max-width:173px;margin-bottom:22px}.puzzle-slot.punctuation-slot{min-width:100px;max-width:150px}.score-details{grid-template-columns:repeat(4,1fr)}.sentence-info{text-align:left;justify-content:flex-start}.translation-text{margin-top:0;margin-left:5px}.file-upload-header{flex-wrap:nowrap}.header-left{max-width:calc(100% - 200px)}.tool-description{max-width:100%}}
@media (min-width:992px){h1{font-size:2rem;max-width:100%}.mode-container{min-width:250px}h1{font-size:clamp(1.8rem,3vw,2rem);white-space:normal;overflow:visible;line-height:1.2}}
.header-grid{display:grid;grid-template-columns:1fr auto;grid-template-areas:"left right";gap:15px;margin-bottom:20px;align-items:center}
.header-left{grid-area:left;display:flex;flex-direction:column;gap:8px}
.header-right{grid-area:right;display:flex;flex-direction:column;align-items:flex-end;gap:8px}
.stats-section{background:rgba(255,255,255,0.92);border-radius:12px;padding:16px;margin-top:16px;box-shadow:0 5px 15px rgba(0,0,0,0.15)}
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
.stats-item{background:rgba(255,255,255,0.7);padding:10px;border-radius:8px;text-align:center;font-weight:bold;color:#1a2a6c}
.stats-value{display:block;margin-top:5px;font-size:1.15rem}
.corpus-section-compressed{background:rgba(255,255,255,0.92);border-radius:12px;padding:12px;margin-top:16px;box-shadow:0 5px 15px rgba(0,0,0,0.15)}
.corpus-title-inline{font-size:1.5rem;color:#1a2a6c;font-weight:bold;margin-bottom:8px;text-align:left}
.file-upload-container{display:flex;flex-direction:column;gap:8px}
.file-upload-row{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.file-upload-btn{background:#1a2a6c;color:#fff;border:none;border-radius:8px;padding:8px 14px;font-weight:bold;cursor:pointer}
.file-name{color:#333;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:60%}
.upload-status{font-size:0.95rem;color:#555}
.main-content{display:grid;grid-template-columns:2fr 1fr;gap:20px}
@media (max-width:991px){.main-content{grid-template-columns:1fr}}
.left-column{display:flex;flex-direction:column;gap:16px;min-height:100%}
.stats-section{background:rgba(255,255,255,0.92);border-radius:12px;padding:16px;box-shadow:0 5px 15px rgba(0,0,0,0.15)}
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
.stats-item{background:rgba(255,255,255,0.7);padding:10px;border-radius:8px;text-align:center;font-weight:bold;color:#1a2a6c}
.stats-value{display:block;margin-top:5px;font-size:1.1rem}
.corpus-management-section{background:#f8f9fa;border-radius:8px;padding:16px;margin-top:16px;border:1px solid #ddd;box-shadow:0 2px 5px rgba(0,0,0,0.05)}
.corpus-header{font-size:1.2rem;color:#1a2a6c;font-weight:bold;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid #ddd}
.upload-row{display:flex;flex-wrap:wrap;align-items:center;gap:12px}
.upload-controls{display:flex;align-items:center;gap:12px;flex:1;min-width:200px}
.upload-status-container{flex:1;min-width:50%;text-align:right}
.corpus-hint{font-size:0.85rem;color:#666;flex:1;min-width:100%;padding:8px;background:rgba(255,255,255,0.7);border-radius:6px;text-align:center;width:297.5px;display:flex;align-items:center;justify-content:center}
@media (min-width:768px){.upload-row{flex-wrap:nowrap;align-items:center}.upload-controls{flex:2}.upload-status-container{flex:0 0 auto;min-width:0;align-self:stretch;display:flex;align-items:center;justify-content:flex-end}.corpus-hint{min-width:0;flex:0 0 auto;text-align:right;align-self:stretch;display:flex;align-items:center;justify-content:center;margin-left:auto;padding-right:0}.upload-status{margin-top:0;width:auto;text-align:right}}
.puzzle-container.simple-mode .puzzle-slot{min-width:104px!important;max-width:138px!important;flex:0 0 calc(33.333% - 15px)!important}
@media (max-width:767px){.puzzle-container.simple-mode .puzzle-slot{min-width:104px!important;max-width:138px!important}}
.puzzle-slot:empty::after{content:"â†“ æ”¾ç½®ä½ç½®";color:#999;font-size:0.7rem;font-style:italic;position:absolute;top:50%;left:0;right:0;transform:translateY(-50%);text-align:center}
.empty-state{text-align:center;padding:16px;background:rgba(255,255,255,0.8);border-radius:8px;margin:10px 0;display:none}
.empty-state.show{display:block}
.empty-state p{margin-bottom:10px;font-weight:bold;color:#1a2a6c}
.guide-animation{font-size:2rem;animation:bounce 1.5s infinite}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.loading-spinner{display:inline-block;width:16px;height:16px;border:3px solid rgba(255,255,255,0.3);border-radius:50%;border-top-color:white;animation:spin 1s ease-in-out infinite;margin-right:8px}
.initial-hint{text-align:center;padding:20px;color:#666;font-style:italic}

/* Mobile-specific refinements for better fit and alignment */
@media (max-width:767px){
  .advanced-tip{top:56px;font-size:0.85rem;padding:6px 12px}
  .puzzle-container{gap:8px}
  .puzzle-slot{min-width:92px;max-width:128px;height:46px}
  .puzzle-slot.punctuation-slot{min-width:80px;max-width:110px}
  .puzzle-slot::before{top:-20px;font-size:0.72rem;padding:2px 6px}
  .puzzle-piece{min-width:64px;min-height:36px;height:auto;font-size:0.9rem;white-space:normal;word-break:break-word;overflow-wrap:anywhere;line-height:1.2;padding:6px 10px}
  .puzzle-slot>.puzzle-piece{white-space:normal}
  .translation-text{font-size:0.95rem}
}
</style>
</head>
<body style="height:100%">
<div class="container">
<div class="advanced-tip" id="advancedTip">æç¤ºï¼šè¿›é˜¶æ¨¡å¼ä¸‹æœ‰éƒ¨åˆ†æ‹¼å›¾ä¸éœ€è¦</div>
<header class="header-grid">
  <div class="header-left">
    <h1>è‡³å…ƒå¾·è¯­ - é€ å¥ç»ƒä¹ å™¨ A1-1</h1>
    <p class="tool-description">å®Œæˆæ‹¼å›¾ï¼ŒæŒæ¡å››å¤§å¥å‹å’ŒåŠ¨è¯ç¬¬äºŒä½è§„å¾‹</p>
  </div>
  <div class="header-right">
    <div class="mode-title">å¥å‹å’ŒåŠ¨è¯çš„ä½ç½®ç»ƒä¹ </div>
    <div class="mode-selector">
      <div class="mode-btn active" id="simpleModeBtn">ç®€å•æ¨¡å¼</div>
      <div class="mode-btn" id="advancedModeBtn">è¿›é˜¶æ¨¡å¼</div>
    </div>
  </div>
</header>

<div class="main-content">
  <div class="left-column">
    <section class="exercise-section">
      <div class="sentence-puzzle-header">
        <h2 class="section-title">å¥å‹æ‹¼å›¾ç»ƒä¹ </h2>
        <div aria-hidden="true" class="reading-indicator" id="readingIndicator">
          <div class="reading-dot dot1"></div>
          <div class="reading-dot dot2"></div>
          <div class="reading-dot dot3"></div>
        </div>
      </div>
      <div class="sentence-info">
        ä¸­æ–‡ï¼š<span class="translation-text" id="currentTranslation">è¯·ä¸Šä¼ è¯­æ–™åº“å¼€å§‹ç»ƒä¹ </span>
      </div>
      
      <div class="empty-state" id="emptyState">
        <p>è¯·ä»ä¸‹æ–¹è¯æ±‡åŒºæ‹–æ‹½å•è¯åˆ°å¥å­æ¡†æ¶ä¸­</p>
        <div class="guide-animation">â†“</div>
      </div>
      
      <div class="puzzle-container-wrapper">
        <div class="puzzle-container" id="puzzleContainer">
          <div class="puzzle-slot" data-label="ç¬¬1ä½" id="slot1"></div>
          <div class="puzzle-slot" data-label="ç¬¬2ä½" id="slot2"></div>
          <div class="puzzle-slot" data-label="å…¶ä»–ä½" id="slot3"></div>
          <div class="puzzle-slot punctuation-slot" data-label="æ ‡ç‚¹" id="slot4"></div>
        </div>
      </div>
      
      <div class="word-bank" id="wordBank"></div>
      <div class="controls">
        <button class="btn btn-secondary" id="resetBtn">é‡ç½®æ‹¼å›¾</button>
        <button class="btn btn-submit" id="submitBtn">æäº¤ç­”æ¡ˆ <span class="btn-icon">ğŸ’¡</span></button>
        <button class="btn btn-success" id="nextBtn">ä¸‹ä¸€é¢˜</button>
        <div class="next-button-warning" id="nextButtonWarning">è¯·å…ˆæäº¤ç­”æ¡ˆï¼Œå†è¿›è¡Œä¸‹ä¸€é¢˜ï¼</div>
      </div>
      <div class="feedback" id="feedback">
        <div class="feedback-header">
          <h3 class="feedback-title">è¯„ä»·åŠè§£æ</h3>
          <div class="current-score-container" id="currentScoreContainer">
            å¾—åˆ†ï¼š<span id="currentScore">0</span> / <span id="maxScore">5</span>
          </div>
        </div>
        <div class="reference-answer">å‚è€ƒç­”æ¡ˆ: <span id="referenceAnswer"></span></div>
        <div class="score-details">
          <div class="score-item"><div>ç¬¬1ä½</div><div class="score-value" id="slot1Score">0</div></div>
          <div class="score-item"><div>ç¬¬2ä½</div><div class="score-value" id="slot2Score">0</div></div>
          <div class="score-item"><div>å…¶ä»–ä½</div><div class="score-value" id="slot3Score">0</div></div>
          <div class="score-item"><div>æ ‡ç‚¹</div><div class="score-value" id="slot4Score">0</div></div>
        </div>
        <div class="initial-hint" id="initialHint">å®Œæˆç»ƒä¹ åï¼Œæ˜¾ç¤ºç­”æ¡ˆè§£æå’Œå¾—åˆ†</div>
      </div>
    </section>
    <section class="stats-section">
      <div class="stats-grid">
        <div class="stats-item">å®Œæˆé¢˜æ•°<span class="stats-value" id="totalCompleted">0</span></div>
        <div class="stats-item">æ­£ç¡®ç‡<span class="stats-value" id="accuracy">0%</span></div>
        <div class="stats-item">é«˜é¢‘é”™è¯¯<span class="stats-value" id="topErrors">-</span></div>
        <div class="stats-item">å‰©ä½™ç­”é¢˜æ•°<span class="stats-value" id="remainingQuestions">0</span></div>
      </div>
    </section>
  </div>
  
  <section class="theory-section">
    <h2 class="section-title">ç»ƒä¹ è¦ç‚¹</h2>
    <div style="margin-top:10px;">
      <h3 style="color:#1a2a6c;">ç»ƒä¹ è¯æ±‡è¡¨</h3>
      <div id="vocabContainer">
        <!-- åŠ¨æ€ç”Ÿæˆè¯æ±‡è¡¨ -->
      </div>
    </div>
    <div style="margin-top:16px;">
      <h3 style="color:#1a2a6c;">è¯­æ³•å°è´´å£«</h3>
      <div class="theory-card">
        <ul>
          <li>ç¬¬1ä½å…ˆç¡®å®šå¥å‹ï¼Œå†é€‰æ‹©å†…å®¹</li>
          <li>å››å¤§å¥å‹å’Œç¬¬1ä½çš„å…³ç³»:
            <ul>
              <li>é™ˆè¿°å¥çš„ç¬¬1ä½é€šå¸¸æ˜¯ä¸»è¯­æˆ–å…¶ä»–</li>
              <li>W-ç–‘é—®å¥ç¬¬1ä½æ˜¯W-ç–‘é—®è¯</li>
              <li>å‘½ä»¤å¥å’ŒJa/Neinç–‘é—®å¥ç¬¬1ä½ç©ºç¼º</li>
            </ul>
          </li>
          <li>å§‹ç»ˆæ³¨æ„åŠ¨è¯çš„ä½ç½® - å¿…é¡»åœ¨ç¬¬äºŒä½</li>
        </ul>
      </div>
    </div>
  </section>
</div>

<!-- è¯­æ–™åº“ç®¡ç†åŒºåŸŸ -->
<section class="corpus-management-section">
  <div class="corpus-header">è¯­æ–™åº“ç®¡ç†</div>
  <div class="upload-row">
    <div class="upload-controls">
      <button class="file-upload-btn" id="uploadBtn">
        <svg fill="none" height="20" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="20">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="17 8 12 3 7 8"></polyline>
          <line x1="12" x2="12" y1="3" y2="15"></line>
        </svg>
        ä¸Šä¼ æœ¬åœ°è¯­æ–™
      </button>
      <button class="file-upload-btn" id="fetchJsonBtn" style="background:#2a6c1a;">
        <svg fill="white" height="20" viewBox="0 0 24 24" width="20">
          <path d="M12 21c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm6-7h-1.7c0 3-2.5 5.1-5.3 5.1S6.7 17 6.7 14H5c0 3.4 2.7 6.2 6 6.7V23h2v-2.3c3.3-.5 6-3.3 6-6.7zm-9-9.9V1h2v3.1c3.4.5 6 3.3 6 6.7h-1.7c0-3-2.5-5.1-5.3-5.1S6.7 7 6.7 10H5c0-3.4 2.7-6.2 6-6.7z"/>
        </svg>
        è·å–äº‘ç«¯è¯­æ–™
      </button>
      <input type="file" id="corpusFile" accept=".json" style="display:none;">
      <span class="file-name" id="fileName">æœªé€‰æ‹©æ–‡ä»¶</span>
    </div>
    
    <div class="upload-status-container">
      <div class="upload-status" id="uploadStatus"></div>
    </div>
    
    <!-- æˆæƒæç¤º -->
    <div class="corpus-hint">
      è¯·æœ¬åœ°ä¸Šä¼ æˆ–äº‘ç«¯åŠ è½½è¯­æ–™åº“json
    </div>
  </div>
</section>

<div class="copyright">Â© 2025 è‡³å…ƒå¾·è¯­åŸåˆ›å¼€å‘ï¼Œä»…ä¾›å†…éƒ¨å­¦ç”Ÿä½¿ç”¨ï¼Œæœªç»ä¹¦é¢è®¸å¯ç¦æ­¢å¤åˆ¶ã€ä¼ æ’­æˆ–å•†ç”¨ã€‚</div>
<script>
const AppConfig={REMOTE_URL:"https://zydeutsch-chen.github.io/ZYDetusch-model/A1-1sentences-encrypted.json",exerciseType:'A1-1',slots:{labels:['ç¬¬1ä½','ç¬¬2ä½','å…¶ä»–ä½','æ ‡ç‚¹'],scoring:{simple:{slot1:2,slot2:2,slot3:1},advanced:{slot1:1.5,slot2:2,slot3:1,slot4:0.5}}},vocabCategories:[{id:'questionWords',name:'ç–‘é—®è¯',color:'#ffcc80'},{id:'verbs',name:'åŠ¨è¯',color:'#a5d6a7'},{id:'subjects',name:'ä¸»è¯­',color:'#90caf9'},{id:'others',name:'å…¶ä»–',color:'#f48fb1'}],uiStrings:{chinese:{uploadHint:'è¯·é€‰æ‹©æœ¬åœ°ä¸Šä¼ æˆ–äº‘ç«¯åŠ è½½è¯­æ–™åº“json',emptyStateText:'è¯·ä»ä¸‹æ–¹è¯æ±‡åŒºæ‹–æ‹½å•è¯åˆ°å¥å­æ¡†æ¶ä¸­',nextButtonWarning:'è¯·å…ˆæäº¤ç­”æ¡ˆï¼Œå†è¿›è¡Œä¸‹ä¸€é¢˜ï¼',advancedTip:'æç¤ºï¼šè¿›é˜¶æ¨¡å¼ä¸‹æœ‰éƒ¨åˆ†æ‹¼å›¾ä¸éœ€è¦'}}};

const Decryptor={decryptCorpusIfNeeded(payload){try{if(typeof payload==='object')return payload;const trimmedPayload=payload.trim();if(trimmedPayload.startsWith('{')||trimmedPayload.startsWith('['))return JSON.parse(trimmedPayload);const keySuffix="et";let processedPayload=trimmedPayload;if(processedPayload.endsWith(keySuffix))processedPayload=processedPayload.slice(0,-keySuffix.length);let base64Str=processedPayload.replace(/^data:[^;]+;base64,/,'').replace(/[\s\n]/g,'').replace(/-/g,'+').replace(/_/g,'/');const pad=base64Str.length%4;if(pad)base64Str+='='.repeat(4-pad);const binaryString=atob(base64Str);const bytes=new Uint8Array(binaryString.length);for(let i=0;i<binaryString.length;i++)bytes[i]=binaryString.charCodeAt(i);const plainBytes=this.xorWithKey(bytes,"ZY-secret");const jsonStr=new TextDecoder().decode(plainBytes);return JSON.parse(jsonStr)}catch(error){console.error('è§£å¯†å¤±è´¥:',error);throw new Error(`è§£å¯†å¤±è´¥: ${error.message}`)}},xorWithKey(bytes,key){const keyBytes=new TextEncoder().encode(key);const result=new Uint8Array(bytes.length);for(let i=0;i<bytes.length;i++)result[i]=bytes[i]^keyBytes[i%keyBytes.length];return result}};

const RemoteLoader={async loadRemoteCorpus(){const statusElement=document.getElementById('uploadStatus');const fetchBtn=document.getElementById('fetchJsonBtn');const originalBtnText=fetchBtn.innerHTML;const urls=["https://zydeutsch-chen.github.io/ZYDetusch-model/A1-1sentences-encrypted.json","https://raw.githubusercontent.com/zydeutsch-chen/ZYDetusch-model/main/A1-1sentences-encrypted.json"];try{statusElement.textContent='æ­£åœ¨è¿æ¥æœåŠ¡å™¨...';statusElement.className='upload-status';statusElement.style.display='block';fetchBtn.disabled=true;fetchBtn.innerHTML='<div class="loading-spinner"></div>è·å–ä¸­...';let response,encryptedText;for(let i=0;i<urls.length;i++){try{statusElement.textContent=`æ­£åœ¨å°è¯•è¿æ¥æœåŠ¡å™¨ ${i+1}/${urls.length}...`;response=await fetch(urls[i],{method:'GET',mode:'cors',headers:{'Accept':'application/json'}});if(response.ok){encryptedText=await response.text();break}}catch(e){console.warn(`URL ${i+1} å¤±è´¥:`,e);if(i===urls.length-1)throw new Error(`æ‰€æœ‰æœåŠ¡å™¨è¿æ¥å¤±è´¥: ${e.message}`)}}if(!response||!response.ok)throw new Error(`ç½‘ç»œé”™è¯¯: ${response?.status} ${response?.statusText}`);statusElement.textContent='æ­£åœ¨è§£å¯†æ•°æ®...';const corpusData=Decryptor.decryptCorpusIfNeeded(encryptedText);if(!corpusData.sentences||!Array.isArray(corpusData.sentences))throw new Error("æ— æ•ˆçš„è¯­æ–™åº“æ ¼å¼: ç¼ºå°‘å¥å­æ•°æ®");if(!corpusData.vocabulary||typeof corpusData.vocabulary!=='object')throw new Error("æ— æ•ˆçš„è¯­æ–™åº“æ ¼å¼: ç¼ºå°‘è¯æ±‡è¡¨æ•°æ®");statusElement.textContent='è¯­æ–™åº“åŠ è½½æˆåŠŸï¼';statusElement.className='upload-status success';return corpusData}catch(error){console.error('åŠ è½½è¿œç¨‹è¯­æ–™åº“å¤±è´¥:',error);let errorMsg=error.message;if(errorMsg.includes('NetworkError')||errorMsg.includes('Failed to fetch'))errorMsg='ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•';else if(errorMsg.includes('CORS'))errorMsg='è·¨åŸŸè®¿é—®è¢«é˜»æ­¢ï¼Œè¯·ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ä¸Šä¼ ';statusElement.textContent=`é”™è¯¯: ${errorMsg}`;statusElement.className='upload-status error';throw error}finally{fetchBtn.innerHTML=originalBtnText;fetchBtn.disabled=false}}};

const Model=(()=>{let sentences=[];let vocabulary={questionWords:new Set(),verbs:new Set(),subjects:new Set(),others:new Set(),punctuation:new Set([".","?"])};let statistics={totalCompleted:0,perfectCount:0,errorCounts:{slot1:0,slot2:0,slot3:0},answeredCount:0,totalErrors:0,totalQuestions:0};let usedIndices=new Set();const loadCorpus=(data)=>{if(!data.sentences||!Array.isArray(data.sentences))throw new Error('æ— æ•ˆçš„è¯­æ–™åº“æ ¼å¼: ç¼ºå°‘å¥å­æ•°æ®');sentences=data.sentences.map(s=>{const parts={...s.parts};Object.keys(parts).forEach(key=>{if(parts[key]==="ç©ºç¼º")parts[key]=""});return{...s,parts}});vocabulary.questionWords=new Set(data.vocabulary?.questionWords||[]);vocabulary.verbs=new Set(data.vocabulary?.verbs||[]);vocabulary.subjects=new Set(data.vocabulary?.subjects||[]);vocabulary.others=new Set(data.vocabulary?.others||[]);vocabulary.punctuation=new Set(data.vocabulary?.punctuation||[".","?"]);usedIndices=new Set();statistics.totalQuestions=sentences.length;return true};const getRandomSentence=()=>{if(sentences.length===0)return{parts:{slot1:"",slot2:"",slot3:"",slot4:""},full:"è¯·ä¸Šä¼ è¯­æ–™åº“",translation:"è¯·ä¸Šä¼ è¯­æ–™åº“å¼€å§‹ç»ƒä¹ ",weight:1};if(usedIndices.size>=50||usedIndices.size===sentences.length)return{parts:{slot1:"",slot2:"",slot3:"",slot4:""},full:"æ­å–œä½ ï¼Œä½ å·²å®Œæˆæ‰€æœ‰ç»ƒä¹ ï¼",translation:"æ­å–œä½ ï¼Œä½ å·²å®Œæˆæ‰€æœ‰ç»ƒä¹ ï¼",weight:1,isCompleted:true};const availableIndices=[];sentences.forEach((sentence,index)=>{if(!usedIndices.has(index))availableIndices.push(index)});const totalWeight=availableIndices.reduce((sum,index)=>sum+sentences[index].weight,0);let random=Math.random()*totalWeight;for(const index of availableIndices){random-=sentences[index].weight;if(random<=0){usedIndices.add(index);return sentences[index]}}return sentences[availableIndices[0]]};const updateStatistics=(scoreResult,isAdvancedMode)=>{statistics.totalCompleted+=1;statistics.answeredCount+=1;if(scoreResult.total<5)statistics.totalErrors+=1;if(scoreResult.total===5)statistics.perfectCount+=1;const{scores}=scoreResult;if(scores.slot1<(isAdvancedMode?1.5:2))statistics.errorCounts.slot1+=1;if(scores.slot2<2)statistics.errorCounts.slot2+=1;if(scores.slot3<(isAdvancedMode?1:1))statistics.errorCounts.slot3+=1};const getStatistics=()=>statistics;const getVocabulary=()=>vocabulary;return{sentences,vocabulary,statistics,loadCorpus,getRandomSentence,updateStatistics,getStatistics,getVocabulary}})();

const Speech=(()=>{let userInteracted=false;let isSpeaking=false;let chineseVoice=null;let germanVoice=null;let voicesReady=false;let lastSpokenTranslation="";const initSpeech=()=>{if(!userInteracted)return;if(!voicesReady){const voices=window.speechSynthesis.getVoices();if(voices.length===0){window.speechSynthesis.onvoiceschanged=()=>{voicesReady=true;initSpeech()};return}voicesReady=true}const voices=window.speechSynthesis.getVoices();chineseVoice=voices.find(v=>v.lang.includes('zh')&&v.name.toLowerCase().includes('female'))||voices.find(v=>v.lang.includes('zh'));germanVoice=voices.find(v=>(v.lang==='de-DE'||v.lang==='de-CH'||v.lang==='de')&&v.name.toLowerCase().includes('male'))||voices.find(v=>v.lang.includes('de'))};const speakChinese=(text)=>{if(!userInteracted)return;if(lastSpokenTranslation===text)return;if(!chineseVoice){initSpeech();if(!chineseVoice){console.log("æ²¡æœ‰æ‰¾åˆ°ä¸­æ–‡è¯­éŸ³");return}}if(isSpeaking)window.speechSynthesis.cancel();const utterance=new SpeechSynthesisUtterance(text);if(chineseVoice){utterance.voice=chineseVoice;utterance.lang=chineseVoice.lang||'zh-CN'}else{utterance.lang='zh-CN'}utterance.rate=0.9;const indicator=document.getElementById('readingIndicator');indicator&&indicator.classList.add('speaking');isSpeaking=true;utterance.onend=()=>{indicator&&indicator.classList.remove('speaking');isSpeaking=false;lastSpokenTranslation=text};window.speechSynthesis.speak(utterance)};const speakGerman=(text)=>{if(!userInteracted)return;if(!germanVoice){initSpeech();if(!germanVoice){console.log("æ²¡æœ‰æ‰¾åˆ°å¾·è¯­è¯­éŸ³");return}}if(isSpeaking)window.speechSynthesis.cancel();const utterance=new SpeechSynthesisUtterance(text);if(germanVoice){utterance.voice=germanVoice;utterance.lang=germanVoice.lang||'de-DE'}else{utterance.lang='de-DE'}utterance.rate=0.9;const indicator=document.getElementById('readingIndicator');indicator&&indicator.classList.add('speaking');isSpeaking=true;utterance.onend=()=>{indicator&&indicator.classList.remove('speaking');isSpeaking=false};window.speechSynthesis.speak(utterance)};document.addEventListener('click',()=>{if(!userInteracted){userInteracted=true;initSpeech()}});return{speakChinese,speakGerman}})();

const Algorithm=(()=>{const getAllVocabulary=()=>{const allWords=new Set();Model.vocabulary.questionWords.forEach(word=>allWords.add(word));Model.vocabulary.verbs.forEach(word=>allWords.add(word));Model.vocabulary.subjects.forEach(word=>allWords.add(word));Model.vocabulary.others.forEach(word=>allWords.add(word));Model.vocabulary.punctuation.forEach(word=>allWords.add(word));return allWords};const getDistractorWords=(sentence)=>{const distractorWords=getAllVocabulary();Object.values(sentence.parts).forEach(part=>{distractorWords.delete(part)});distractorWords.delete(".");distractorWords.delete("?");distractorWords.delete("");return Array.from(distractorWords)};const calculateScore=(userAnswers,correctAnswers,isAdvancedMode)=>{const scores={slot1:0,slot2:0,slot3:0,slot4:0};if(userAnswers.slot1===correctAnswers.slot1)scores.slot1=isAdvancedMode?AppConfig.slots.scoring.advanced.slot1:AppConfig.slots.scoring.simple.slot1;if(userAnswers.slot2===correctAnswers.slot2)scores.slot2=isAdvancedMode?AppConfig.slots.scoring.advanced.slot2:AppConfig.slots.scoring.simple.slot2;if(isAdvancedMode){if(userAnswers.slot3===correctAnswers.slot3)scores.slot3=AppConfig.slots.scoring.advanced.slot3;if(userAnswers.slot4===correctAnswers.slot4)scores.slot4=AppConfig.slots.scoring.advanced.slot4}else{const expectedSlot3=correctAnswers.slot3+correctAnswers.slot4;if(userAnswers.slot3===expectedSlot3)scores.slot3=AppConfig.slots.scoring.simple.slot3}const total=Object.values(scores).reduce((sum,score)=>sum+score,0);return{scores,total:Math.round(total*10)/10}};return{getDistractorWords,calculateScore}})();

const MobileClick=(()=>{const isMobile=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);let isClickEnabled=false;const initClickSelection=()=>{if(!isMobile())return;isClickEnabled=true;const bank=document.getElementById('wordBank');const pc=document.getElementById('puzzleContainer');if(!bank||!pc)return;bank.addEventListener('click',handleWordClick,{passive:true});pc.addEventListener('click',handleSlotClick,{passive:true});
  // ä½¿ç”¨å·²æœ‰çš„ advanced-tip æ ·å¼ï¼Œæ˜¾ç¤ºç´§å‡‘æç¤º
  const tipEl=document.getElementById('advancedTip');
  if(tipEl){
    tipEl.textContent='æç¤ºï¼šç‚¹å‡»ä¸‹æ–¹æ‹¼å›¾ä¾æ¬¡å¡«å…¥ä¸Šæ–¹ï¼›ç‚¹å‡»å·²æ”¾ç½®å¯æ’¤å›';
    tipEl.classList.add('show');
    setTimeout(()=>tipEl.classList.remove('show'),2500);
  }
};const handleWordClick=e=>{if(!isClickEnabled)return;const wordElement=e.target.closest('.puzzle-piece');if(!wordElement||!wordElement.parentElement||wordElement.parentElement.id!=='wordBank')return;const slots=[document.getElementById('slot1'),document.getElementById('slot2'),document.getElementById('slot3'),document.getElementById('slot4')];const emptySlot=slots.find(slot=>!slot.firstChild);if(!emptySlot)return;moveWordToSlot(wordElement,emptySlot)};const handleSlotClick=e=>{if(!isClickEnabled)return;const slot=e.target.closest('.puzzle-slot');if(!slot||!slot.firstChild)return;removeWordFromSlot(slot)};const moveWordToSlot=(wordElement,slot)=>{const clone=wordElement.cloneNode(true);if(window.UI?.isAdvancedMode&&slot.id===window.UI?.currentFirstInitialSlot&&clone.textContent)clone.textContent=clone.textContent.charAt(0).toUpperCase()+clone.textContent.slice(1);slot.appendChild(clone);slot.classList.add('filled');wordElement.remove()};const removeWordFromSlot=slot=>{const wordElement=slot.firstChild;let originalText=wordElement.textContent;if(window.UI?.isAdvancedMode&&slot.id===window.UI?.currentFirstInitialSlot&&originalText)originalText=originalText.charAt(0).toLowerCase()+originalText.slice(1);wordElement.textContent=originalText;const bank=document.getElementById('wordBank');if(bank)bank.appendChild(wordElement);slot.classList.remove('filled')};return{initClickSelection}})();

/* ç”¨æˆ·ç•Œé¢æ¨¡å— */
const UI = (() => {
  // DOMå…ƒç´ 
  const elements = {
    slot1: document.getElementById("slot1"),
    slot2: document.getElementById("slot2"),
    slot3: document.getElementById("slot3"),
    slot4: document.getElementById("slot4"),
    wordBank: document.getElementById("wordBank"),
    feedback: document.getElementById("feedback"),
    referenceAnswer: document.getElementById("referenceAnswer"),
    currentTranslation: document.getElementById("currentTranslation"),
    slot1Score: document.getElementById("slot1Score"),
    slot2Score: document.getElementById("slot2Score"),
    slot3Score: document.getElementById("slot3Score"),
    slot4Score: document.getElementById("slot4Score"),
    currentScore: document.getElementById("currentScore"),
    maxScore: document.getElementById("maxScore"),
    currentScoreContainer: document.getElementById("currentScoreContainer"),
    simpleModeBtn: document.getElementById("simpleModeBtn"),
    advancedModeBtn: document.getElementById("advancedModeBtn"),
    resetBtn: document.getElementById("resetBtn"),
    submitBtn: document.getElementById("submitBtn"),
    nextBtn: document.getElementById("nextBtn"),
    advancedTip: document.getElementById("advancedTip"),
    nextButtonWarning: document.getElementById("nextButtonWarning"),
    readingIndicator: document.getElementById("readingIndicator"),
    uploadBtn: document.getElementById("uploadBtn"),
    corpusFile: document.getElementById("corpusFile"),
    fileName: document.getElementById("fileName"),
    uploadStatus: document.getElementById("uploadStatus"),
    totalCompleted: document.getElementById("totalCompleted"),
    accuracy: document.getElementById("accuracy"),
    topErrors: document.getElementById("topErrors"),
    remainingQuestions: document.getElementById("remainingQuestions"),
    puzzleContainer: document.getElementById("puzzleContainer"),
    vocabContainer: document.getElementById("vocabContainer"),
    emptyState: document.getElementById("emptyState"),
    fetchJsonBtn: document.getElementById("fetchJsonBtn"),
    initialHint: document.getElementById("initialHint")
  }; 
  
  // çŠ¶æ€å˜é‡
  let isAdvancedMode = false;
  let isSubmitted = false;
  let nextButtonWarningShown = false;
  let consecutiveNextClicks = 0;
  let currentSentence = null;
  let draggedElement = null;
  let currentFirstInitialSlot = 'slot1';
  let hasFilledAllSlots = false;

  // åˆå§‹åŒ–æ‹–æ”¾åŠŸèƒ½
  const initDragAndDrop = () => {
    const slots = [elements.slot1, elements.slot2, elements.slot3, elements.slot4];
    
    // ä¸ºæ§½ä½æ·»åŠ è§¦æ‘¸äº‹ä»¶
    slots.forEach(slot => {
      slot.addEventListener('touchmove', function(e) {
        e.preventDefault();
      });
      
      slot.addEventListener('touchend', function(e) {
        if (!draggedElement) return;
        
        e.preventDefault();
        
        if (this.firstChild) {
          const existingPiece = this.firstChild;
          elements.wordBank.appendChild(existingPiece);
        }
        
        this.innerHTML = "";
        const clone = draggedElement.cloneNode(true);
        
        // è¿›é˜¶æ¨¡å¼ä¸”æ˜¯slot1ä½ç½®ï¼šé¦–å­—æ¯å¤§å†™
        if (isAdvancedMode && this.id === currentFirstInitialSlot && clone.textContent) {
          clone.textContent = clone.textContent.charAt(0).toUpperCase() + clone.textContent.slice(1);
        }
        
        this.appendChild(clone);
        this.classList.add('filled');
        
        draggedElement.remove();
        draggedElement = null;
      });
    });
    
    // ä¸ºæ§½ä½æ·»åŠ é¼ æ ‡äº‹ä»¶
    slots.forEach(slot => {
      slot.ondragover = e => e.preventDefault();
      
      slot.ondrop = e => {
        e.preventDefault();
        let data;
        try {
          data = JSON.parse(e.dataTransfer.getData("application/json"));
        } catch (error) {
          console.error("è§£ææ‹–æ‹½æ•°æ®å¤±è´¥:", error);
          return;
        }
        
        if (slot.firstChild) {
          const existingPiece = slot.firstChild;
          elements.wordBank.appendChild(existingPiece);
        }
        
        slot.innerHTML = "";
        const el = document.createElement("div");
        el.className = "puzzle-piece";
        
        if (data.text === "." || data.text === "?") {
          el.classList.add("punctuation");
        }
        
        // ç©ºå­—ç¬¦ä¸²æ·»åŠ ç‰¹æ®Šæ ·å¼
        if (data.text === "") {
          el.classList.add("empty-slot");
        }
        
        // è¿›é˜¶æ¨¡å¼ä¸”æ˜¯slot1ä½ç½®ï¼šé¦–å­—æ¯å¤§å†™
        let displayText = data.text;
        if (isAdvancedMode && slot.id === currentFirstInitialSlot && displayText) {
          displayText = displayText.charAt(0).toUpperCase() + displayText.slice(1);
        }
        
        el.textContent = displayText;
        el.draggable = true;
        el.dataset.correctSlot = data.correctSlot;
        slot.appendChild(el);
        slot.classList.add('filled');
        
        // ç§»é™¤å•è¯åº“ä¸­çš„ç›¸åŒå•è¯ï¼ˆä½¿ç”¨åŸå§‹æ–‡æœ¬åŒ¹é…ï¼Œé¿å…å¤§å°å†™é—®é¢˜ï¼‰
        const wordBankPieces = [...elements.wordBank.children];
        for (let i = 0; i < wordBankPieces.length; i++) {
          const originalText = data.text;
          const pieceText = wordBankPieces[i].textContent;
          // æ¯”è¾ƒæ—¶å¿½ç•¥å¤§å°å†™å·®å¼‚
          if (pieceText.toLowerCase() === originalText.toLowerCase()) {
            wordBankPieces[i].remove();
            break;
          }
        }
      };
    });
  };

  // æ˜¾ç¤ºé«˜çº§æç¤º
  const showAdvancedTip = () => {
    elements.advancedTip.textContent = AppConfig.uiStrings.chinese.advancedTip;
    elements.advancedTip.classList.add("show");
    setTimeout(() => {
      elements.advancedTip.classList.remove("show");
    }, 3000);
  };

  // ç»Ÿä¸€æç¤ºå®¹å™¨
  const showWarn = (msg) => {
    elements.nextButtonWarning.textContent = msg;
    elements.nextButtonWarning.classList.add("show");
    setTimeout(() => elements.nextButtonWarning.classList.remove("show"), 2000);
  };

  // åŠ¨æ€ç”Ÿæˆè¯æ±‡è¡¨
  const populateVocabulary = () => {
    elements.vocabContainer.innerHTML = '';
    const vocab = Model.getVocabulary();
    
    AppConfig.vocabCategories.forEach(category => {
      const words = vocab[category.id];
      if (!words || words.size === 0) return;
      
      const section = document.createElement('div');
      section.className = 'vocab-block';
      section.style.backgroundColor = category.color;
      section.style.padding = '10px';
      section.style.borderRadius = '8px';
      section.style.marginBottom = '12px';
      
      const title = document.createElement('strong');
      title.textContent = category.name;
      section.appendChild(title);
      
      const container = document.createElement('div');
      container.className = 'vocab-container';
      
      words.forEach(word => {
        if (word === "") return; // è·³è¿‡ç©ºå­—ç¬¦ä¸²
        
        const item = document.createElement('span');
        item.className = 'vocab-item';
        item.textContent = word;
        container.appendChild(item);
      });
      
      section.appendChild(container);
      elements.vocabContainer.appendChild(section);
    });
  };

  // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
  const updateStatisticsDisplay = () => {
    const stats = Model.statistics;
    elements.totalCompleted.textContent = stats.totalCompleted;
    const accuracy = stats.totalCompleted > 0 ? (stats.perfectCount / stats.totalCompleted * 100).toFixed(0) : 0;
    elements.accuracy.textContent = `${accuracy}%`;
    
    // é«˜é¢‘é”™è¯¯ï¼šåªæœ‰é”™è¯¯é¢˜æ•° >= 3 æ—¶æ‰æ˜¾ç¤º
    if (stats.totalErrors >= 3) {
      const errorCounts = stats.errorCounts;
      let errorsArray = Object.entries(errorCounts)
        .sort((a, b) => {
          if (b[1] !== a[1]) {
            return b[1] - a[1];
          }
          const priority = { 'slot1': 1, 'slot2': 2, 'slot3': 3 };
          return priority[a[0]] - priority[b[0]];
        });
      errorsArray = errorsArray.slice(0, 2);
      const errorNames = errorsArray.map(item => {
        if (item[0] === 'slot1') return '1ä½';
        if (item[0] === 'slot2') return '2ä½';
        if (item[0] === 'slot3') return 'å…¶ä»–ä½';
        return '';
      });
      elements.topErrors.textContent = errorNames.join(' ') || 'æ— ';
    } else {
      elements.topErrors.textContent = "-";
    }
    
    elements.remainingQuestions.textContent = Math.max(0, (Model.sentences?.length || 50) - stats.answeredCount);
  };

  // åŠ è½½å¥å­åˆ°UI
  const loadSentence = (sentence) => {
    [elements.slot1, elements.slot2, elements.slot3, elements.slot4].forEach(s => { s.innerHTML = ""; s.classList.remove('filled'); });
    elements.wordBank.innerHTML = "";
    
    currentSentence = sentence;
    
    // æ£€æŸ¥æ˜¯å¦å·²å®Œæˆæ‰€æœ‰ç»ƒä¹ 
    if (sentence.isCompleted) {
      elements.currentTranslation.textContent = sentence.translation;
      elements.wordBank.innerHTML = '<div class="puzzle-piece" style="background:#4CAF50;color:white;">ç»ƒä¹ å·²å®Œæˆ</div>';
      elements.nextBtn.disabled = true;
      elements.submitBtn.disabled = true;
      return;
    } else {
      elements.nextBtn.disabled = false;
      elements.submitBtn.disabled = false;
    }
    
    // åˆ›å»ºæ‹¼å›¾å—
    let pieces = [];
    
    if (isAdvancedMode) {
      // ç›´æ¥ä½¿ç”¨ç©ºå­—ç¬¦ä¸²
      pieces.push(
        {text: sentence.parts.slot1, correctSlot: "slot1"},
        {text: sentence.parts.slot2, correctSlot: "slot2"},
        {text: sentence.parts.slot3, correctSlot: "slot3"}
      );
      
      // æ ‡ç‚¹ç¬¦å·å¤„ç†
      const puncts = [".", "?"];
      const correctPunct = sentence.parts.slot4;
      const wrongPunct = puncts.find(p => p !== correctPunct);
      
      pieces.push(
        {text: correctPunct, correctSlot: "slot4"},
        {text: wrongPunct, correctSlot: "none"}
      );
      
      // æ·»åŠ å¹²æ‰°è¯ï¼ˆæ’é™¤ç©ºå­—ç¬¦ä¸²ï¼‰
      const distractors = Algorithm.getDistractorWords(sentence);
      if (distractors.length > 0) {
        const randomDistractor = distractors[Math.floor(Math.random() * distractors.length)];
        pieces.push({text: randomDistractor, correctSlot: "none"});
      }
    
      // å¦‚æœç­”æ¡ˆä¸‰æ§½éƒ½ä¸æ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œæ·»åŠ ä¸€ä¸ªç©ºç™½å¹²æ‰°å—
      const hasEmptyInAnswer = [sentence.parts.slot1, sentence.parts.slot2, sentence.parts.slot3].some(x => x === "");
      const hasEmptyPiece = pieces.some(p => p.text === "");
      if (!hasEmptyInAnswer && !hasEmptyPiece) {
        pieces.push({text: "", correctSlot: "none"});
      }

      // è®°å½•å¥å­çš„ç¬¬ä¸€ä¸ªéç©ºæ§½ä½ï¼Œç”¨äºæ˜¾ç¤ºæ—¶éšè—å¥é¦–å¤§å†™çº¿ç´¢
      var firstInitialSlot = sentence.parts.slot1 !== "" ? "slot1" : (sentence.parts.slot2 !== "" ? "slot2" : "slot3");
      var firstInitialText = sentence.parts[firstInitialSlot] || "";
      currentFirstInitialSlot = firstInitialSlot;
      // åŒæ­¥åˆ°å…¨å±€ï¼Œä¾›ç§»åŠ¨ç‚¹å‡»æ¨¡å—ä½¿ç”¨
      if(window.UI){ window.UI.currentFirstInitialSlot = currentFirstInitialSlot; }

    } else {
      // ç®€å•æ¨¡å¼ä¸‹çš„æ‹¼å›¾å— - ä¿®å¤ç©ºå­—ç¬¦ä¸²å¤„ç†
      pieces = [
        {text: sentence.parts.slot1 || "", correctSlot: "slot1"},
        {text: sentence.parts.slot2 || "", correctSlot: "slot2"},
        {text: (sentence.parts.slot3 || "") + (sentence.parts.slot4 || ""), correctSlot: "slot3"}
      ];
    }
    
    // éšæœºæ’åºå¹¶æ·»åŠ åˆ°UI
    pieces.sort(() => Math.random() - 0.5);
    
    pieces.forEach(p => {
      const el = document.createElement("div");
      el.className = "puzzle-piece";
      
      if (p.text === "." || p.text === "?") {
        el.classList.add("punctuation");
      }
      
      // ç©ºå­—ç¬¦ä¸²ä¸æ™®é€šå—ä¸€è‡´æ˜¾ç¤ºï¼ˆä¸æ·»åŠ ç‰¹æ®Šæ ·å¼ï¼‰
      // if (p.text === "") { /* no special class */ }
      
      // è¿›é˜¶æ¨¡å¼ï¼šéšè—å¥é¦–å¤§å†™çº¿ç´¢ï¼ˆä»…åœ¨å¥é¦–ä¸ºç–‘é—®è¯/åŠ¨è¯/äººç§°ä»£è¯/å† è¯meinæ—¶ï¼‰
      let displayText = p.text;
      if (isAdvancedMode && typeof currentFirstInitialSlot !== "undefined" && p.correctSlot === currentFirstInitialSlot && displayText) {
        const m = displayText.match(/^([A-Za-zÃ„Ã–ÃœÃ¤Ã¶Ã¼ÃŸ]+)/u);
        const firstWord = m ? m[1] : "";
        const isFirstUpper = /^[A-ZÃ„Ã–Ãœ]/.test(firstWord);
        const lw = firstWord.toLowerCase();
        const pronouns = new Set(["ich","du","er","sie","es","wir","ihr"]); // ä¸å«"Sie"ä»¥é¿å…è¯¯æ”¹
        const isQ = !!(Model.vocabulary?.questionWords && Model.vocabulary.questionWords.has(lw));
        const isV = !!(Model.vocabulary?.verbs && Model.vocabulary.verbs.has(lw));
        // ä¿ç•™ä¸“æœ‰å/åè¯çš„å¤§å†™ï¼šè‹¥åŸæœ¬é¦–å­—æ¯å¤§å†™ï¼Œä¸”æ—¢ä¸æ˜¯ç–‘é—®è¯ä¹Ÿä¸æ˜¯åŠ¨è¯ä¹Ÿä¸æ˜¯å¸¸è§äººç§°ä»£è¯/"mein"ï¼Œåˆ™ä¸é™çº§
        let isCommonLowerCategory = isQ || isV || pronouns.has(lw) || lw === 'mein';
        let shouldLower = !isFirstUpper || isCommonLowerCategory;
        if (firstWord === 'Sie') { shouldLower = false; }
        if (shouldLower) {
          displayText = displayText.replace(/^(\p{L})/u, ch => ch.toLowerCase());
        }
      }
      el.textContent = displayText;
      el.draggable = true;
      el.dataset.correctSlot = p.correctSlot;
      elements.wordBank.appendChild(el);
      
      // ä¸ºæ‹¼å›¾å—æ·»åŠ äº‹ä»¶
      addTouchEvents(el, p);
      addMouseEvents(el, p);
    });
    
    // æ›´æ–°UIå†…å®¹
    elements.referenceAnswer.textContent = sentence.full;
    elements.currentTranslation.textContent = sentence.translation;
    
    // æ˜¾ç¤ºç©ºçŠ¶æ€å¼•å¯¼
    if (pieces.length > 0) {
      elements.emptyState.classList.remove('show');
    } else {
      elements.emptyState.querySelector('p').textContent = AppConfig.uiStrings.chinese.emptyStateText;
      elements.emptyState.classList.add('show');
    }
    
    // é‡ç½®çŠ¶æ€
    isSubmitted = false;
    nextButtonWarningShown = false;
    
    // æ˜¾ç¤ºåˆå§‹æç¤ºï¼Œéšè—å¾—åˆ†è¯¦æƒ…
    elements.initialHint.style.display = 'block';
    document.querySelector('.score-details').style.display = 'none';
    document.querySelector('.reference-answer').style.display = 'none';
    document.querySelector('.feedback-header').style.display = 'none';
    
    // æœ—è¯»ä¸­æ–‡ç¿»è¯‘
    setTimeout(() => {
      Speech.speakChinese(sentence.translation);
    }, 500);
    
    // æ·»åŠ è§¦æ‘¸äº‹ä»¶å¤„ç†å‡½æ•°
    function addTouchEvents(el, data) {
      el.addEventListener('touchstart', function(e) {
        e.preventDefault();
        draggedElement = el;
        this.classList.add('dragging');
      });
      
      el.addEventListener('touchend', function() {
        this.classList.remove('dragging');
        draggedElement = null;
      });
    }
    
    // æ·»åŠ é¼ æ ‡äº‹ä»¶å¤„ç†å‡½æ•°
    function addMouseEvents(el, data) {
      el.ondragstart = e => {
        try {
          e.dataTransfer.setData("application/json", JSON.stringify(data));
          e.dataTransfer.effectAllowed = "move";
        } catch(err) {
          console.warn('dragstart dataTransfer not supported', err);
        }
      };
    }
  };

  // æ˜¾ç¤ºå¾—åˆ†åé¦ˆ
  const showScoreFeedback = (scoreResult) => {
    const { scores, total } = scoreResult;
    
    // æ›´æ–°å¾—åˆ†æ˜¾ç¤º
    elements.slot1Score.textContent = scores.slot1;
    elements.slot2Score.textContent = scores.slot2;
    elements.slot3Score.textContent = scores.slot3;
    elements.slot4Score.textContent = isAdvancedMode ? scores.slot4 : "-";
    elements.currentScore.textContent = total;
    elements.maxScore.textContent = 5;
    
    // è®¾ç½®å¾—åˆ†é¢œè‰²
    elements.currentScoreContainer.classList.remove("high", "low");
    if (total >= 4) {
      elements.currentScoreContainer.classList.add("high");
    } else {
      elements.currentScoreContainer.classList.add("low");
    }
    
    // æ˜¾ç¤ºåé¦ˆåŒºåŸŸ
    elements.feedback.style.display = "block";
    
    // æ˜¾ç¤ºå¾—åˆ†è¯¦æƒ…ï¼Œéšè—åˆå§‹æç¤º
    document.querySelector('.score-details').style.display = 'grid';
    document.querySelector('.reference-answer').style.display = 'block';
    document.querySelector('.feedback-header').style.display = 'flex';
    elements.initialHint.style.display = 'none';
    
    // æ ‡è®°é”™è¯¯çš„ä½ç½®
    document.querySelectorAll('.score-item').forEach(item => {
      item.classList.remove('error');
    });
    
    if (isAdvancedMode) {
      if (scores.slot1 < AppConfig.slots.scoring.advanced.slot1) 
        document.getElementById('slot1Score').parentNode.classList.add('error');
      if (scores.slot2 < AppConfig.slots.scoring.advanced.slot2) 
        document.getElementById('slot2Score').parentNode.classList.add('error');
      if (scores.slot3 < AppConfig.slots.scoring.advanced.slot3) 
        document.getElementById('slot3Score').parentNode.classList.add('error');
      if (scores.slot4 < AppConfig.slots.scoring.advanced.slot4) 
        document.getElementById('slot4Score').parentNode.classList.add('error');
    } else {
      if (scores.slot1 < AppConfig.slots.scoring.simple.slot1) 
        document.getElementById('slot1Score').parentNode.classList.add('error');
      if (scores.slot2 < AppConfig.slots.scoring.simple.slot2) 
        document.getElementById('slot2Score').parentNode.classList.add('error');
      if (scores.slot3 < AppConfig.slots.scoring.simple.slot3) 
        document.getElementById('slot3Score').parentNode.classList.add('error');
    }
    
    // æ ‡è®°å·²æäº¤
    isSubmitted = true;
    
    // æ›´æ–°ç»Ÿè®¡
    Model.updateStatistics(scoreResult, isAdvancedMode);
    updateStatisticsDisplay();
    
    // å¦‚æœæ»¡åˆ†ï¼Œæœ—è¯»å¾·è¯­å¥å­
    if (total === 5) {
      Speech.speakGerman(currentSentence.full);
    }
  };

  // åˆ·æ–°UI
  const refreshUI = () => {
    populateVocabulary();
    currentSentence = Model.getRandomSentence();
    loadSentence(currentSentence);
    updateStatisticsDisplay();
  };

  // åˆå§‹åŒ–æ–‡ä»¶ä¸Šä¼ 
  const initFileUpload = () => {
    elements.uploadBtn.addEventListener('click', () => {
      elements.corpusFile.click();
    });
    
    elements.corpusFile.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      elements.fileName.textContent = file.name;
      elements.uploadStatus.textContent = 'æ­£åœ¨åŠ è½½è¯­æ–™åº“...';
      elements.uploadStatus.className = 'upload-status';
      elements.uploadStatus.style.display = 'block';
      
      const reader = new FileReader();
      reader.onload = function(event) {
        try {
          const data = JSON.parse(event.target.result);
          
          if (!data.sentences || !Array.isArray(data.sentences)) {
            throw new Error('æ— æ•ˆçš„è¯­æ–™åº“æ ¼å¼: ç¼ºå°‘å¥å­æ•°æ®');
          }
          
          Model.loadCorpus(data);
          
          elements.uploadStatus.textContent = 'è¯­æ–™åº“åŠ è½½æˆåŠŸï¼';
          elements.uploadStatus.className = 'upload-status success';
          
          refreshUI();
        } catch (error) {
          elements.uploadStatus.textContent = 'åŠ è½½å¤±è´¥: ' + error.message;
          elements.uploadStatus.className = 'upload-status error';
          console.error('è¯­æ–™åº“åŠ è½½é”™è¯¯:', error);
        }
      };
      
      reader.onerror = function() {
        elements.uploadStatus.textContent = 'æ–‡ä»¶è¯»å–å¤±è´¥';
        elements.uploadStatus.className = 'upload-status error';
      };
      
      reader.readAsText(file);
    });
  };
  
  // åˆå§‹åŒ–è¿œç¨‹åŠ è½½
  const initRemoteLoader = () => {
    elements.fetchJsonBtn.addEventListener('click', async () => {
      try {
        // åŠ è½½è¿œç¨‹è¯­æ–™åº“
        const corpusData = await RemoteLoader.loadRemoteCorpus();
        
        // åŠ è½½è¯­æ–™åº“åˆ°æ¨¡å‹
        Model.loadCorpus(corpusData);
        
        // æ›´æ–°UI
        elements.fileName.textContent = "äº‘ç«¯è¯­æ–™åº“";
        refreshUI();
        
        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
        setTimeout(() => {
          alert("äº‘ç«¯è¯­æ–™åº“åŠ è½½æˆåŠŸï¼");
        }, 500);
        
      } catch (error) {
        console.error('åŠ è½½è¿œç¨‹è¯­æ–™åº“å¤±è´¥:', error);
      }
    });
  };

  // åˆå§‹åŒ–UI
  const initUI = () => {
    isAdvancedMode = false;
    elements.slot4.style.display = "none";
    elements.puzzleContainer.classList.add('simple-mode');
    
    // åˆå§‹åŒ–ç©ºçŠ¶æ€æ–‡æœ¬
    elements.emptyState.querySelector('p').textContent = AppConfig.uiStrings.chinese.emptyStateText;
    
    populateVocabulary();
    currentSentence = Model.getRandomSentence();
    loadSentence(currentSentence);
    initDragAndDrop();
    initFileUpload();
    initRemoteLoader();
    updateStatisticsDisplay();
    
    // æš´éœ²å˜é‡ç»™ç§»åŠ¨ç‚¹å‡»æ¨¡å—ï¼ˆä¿æŒå¯å˜å¼•ç”¨ï¼‰
    window.UI = window.UI || {};
    window.UI.isAdvancedMode = isAdvancedMode;
    window.UI.currentFirstInitialSlot = currentFirstInitialSlot;
    
    elements.simpleModeBtn.addEventListener("click", () => {
      isAdvancedMode = false;
      window.UI.isAdvancedMode = false;
      elements.simpleModeBtn.classList.add("active");
      elements.advancedModeBtn.classList.remove("active");
      elements.slot4.style.display = "none";
      elements.puzzleContainer.classList.add('simple-mode');
      currentSentence = Model.getRandomSentence();
      loadSentence(currentSentence);
    });
    
    elements.advancedModeBtn.addEventListener("click", () => {
      isAdvancedMode = true;
      window.UI.isAdvancedMode = true;
      elements.advancedModeBtn.classList.add("active");
      elements.simpleModeBtn.classList.remove("active");
      elements.slot4.style.display = "block";
      elements.puzzleContainer.classList.remove('simple-mode');
      currentSentence = Model.getRandomSentence();
      loadSentence(currentSentence);
      showAdvancedTip();
    });
    
    elements.resetBtn.addEventListener("click", () => loadSentence(currentSentence));
    
    elements.nextBtn.addEventListener("click", () => {
      if (!isSubmitted) {
        const placedBasic = [elements.slot1, elements.slot2, elements.slot3]
          .filter(s => s.firstChild && (s.firstChild.textContent ?? "") !== "").length;
        const placed = isAdvancedMode ? placedBasic + (elements.slot4.firstChild ? 1 : 0) : placedBasic;
        if (placed < 2) {
          consecutiveNextClicks += 1;
          if (consecutiveNextClicks === 1) {
            showWarn('å·²è·³è¿‡1é¢˜ï¼šè¯·å°½é‡å°è¯•ä½œç­”ï¼');
            currentSentence = Model.getRandomSentence();
            loadSentence(currentSentence);
        return;
      }
          showWarn('å·²ç¦æ­¢è·³è¿‡ï¼Œè¯·å…ˆå®Œæˆæ‹¼å›¾å†æäº¤ï¼');
          elements.nextBtn.disabled = true;
          return;
        }
        showWarn('è¯·å…ˆæäº¤ç­”æ¡ˆï¼Œå†è¿›è¡Œä¸‹ä¸€é¢˜ï¼');
        return;
      }
      consecutiveNextClicks = 0;
      elements.nextBtn.disabled = false;
      currentSentence = Model.getRandomSentence();
      loadSentence(currentSentence);
    });
    
    elements.submitBtn.addEventListener("click", () => {
      if (currentSentence.isCompleted) return;
      // è‡³å°‘æœ‰2ä¸ªæ‹¼å›¾å—è¢«æ”¾å…¥å³å¯å…è®¸æäº¤ï¼ˆé€‚é…slotå…è®¸ä¸ºç©ºçš„é¢˜å‹ï¼‰
      const placedBasic = [elements.slot1, elements.slot2, elements.slot3]
        .filter(s => s.firstChild && (s.firstChild.textContent ?? "") !== "").length;
      const placed = isAdvancedMode ? placedBasic + (elements.slot4.firstChild ? 1 : 0) : placedBasic;
      if (placed < 2) {
        // è§†ä¸ºè·³è¿‡ï¼Œå…è®¸ä¸€æ¬¡
        consecutiveNextClicks += 1;
        if (consecutiveNextClicks === 1) {
          showWarn('å·²è·³è¿‡1é¢˜ï¼šè¯·å°½é‡å…ˆå°è¯•ä½œç­”ï¼›å†æ¬¡è·³è¿‡å°†è¢«ç¦æ­¢');
          currentSentence = Model.getRandomSentence();
          loadSentence(currentSentence);
          return;
        }
        showWarn('å·²ç¦æ­¢è·³è¿‡ï¼Œè¯·å®Œæˆæ‹¼å›¾å†æäº¤');
        elements.nextBtn.disabled = true;
        return;
      }
      
      const userAnswers = {
        slot1: elements.slot1.firstChild?.textContent || "",
        slot2: elements.slot2.firstChild?.textContent || "",
        slot3: elements.slot3.firstChild?.textContent || "",
        slot4: elements.slot4.firstChild?.textContent || ""
      };
      
      const scoreResult = Algorithm.calculateScore(
        userAnswers, 
        currentSentence.parts, 
        isAdvancedMode
      );
      
      showScoreFeedback(scoreResult);
      // æäº¤åé‡Šæ”¾â€œä¸‹ä¸€é¢˜â€æŒ‰é’®
      consecutiveNextClicks = 0;
      elements.nextBtn.disabled = false;
    });
    
    document.addEventListener("drop", e => e.preventDefault(), false);
    document.addEventListener("dragover", e => e.preventDefault(), false);
  };

  return {
    initUI
  };
})();

// ä¸»ç¨‹åº - åˆå§‹åŒ–åº”ç”¨
document.addEventListener('DOMContentLoaded', () => {
  UI.initUI();
  
  // æ·»åŠ ç‚¹å‡»å•è¯åº“æ¿€æ´»æ•ˆæœ
  document.getElementById('wordBank').addEventListener('click', function() {
    this.classList.add('active');
    setTimeout(() => this.classList.remove('active'), 300);
  });
  
      // åˆå§‹åŒ–ç§»åŠ¨ç«¯ç‚¹å‡»åŠŸèƒ½
    setTimeout(() => {
      MobileClick.initClickSelection();
    }, 100);
});
</script>
</body>
</html>

