<!DOCTYPE html><html lang="zh"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>至元德语 - 造句练习器 A1-1</title><style>*{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;touch-action:manipulation}body{background:linear-gradient(135deg,rgba(26,42,108,.9),rgba(178,31,31,.9),rgba(26,42,108,.9));color:#333;line-height:1.6;padding:12px;min-height:100vh;display:flex;flex-direction:column}.container{max-width:1200px;margin:0 auto;padding:12px;flex:1}header{display:flex;flex-direction:column;justify-content:space-between;color:#fff;text-shadow:0 2px 4px rgba(0,0,0,.3);margin-bottom:12px;padding:10px 0}.header-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.header-title{flex:1;min-width:0;max-width:100%}h1{font-size:1.4rem;margin-bottom:4px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:100%}.tool-description{background:rgba(255,255,255,.2);border-radius:8px;padding:8px;font-size:.85rem;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;line-height:1.4;max-height:3.2em;width:100%}.mode-container{display:flex;flex-direction:column;min-width:150px}.mode-title{font-weight:700;font-size:.95rem;opacity:.9;margin-bottom:6px;text-align:right;white-space:nowrap}.mode-selector{display:flex;gap:6px;width:100%}.mode-btn{height:32px;line-height:32px;padding:0 10px;border-radius:18px;border:2px solid #fc0;color:#fc0;background:rgba(255,255,255,.1);cursor:pointer;font-weight:700;font-size:.9rem;display:flex;align-items:center;justify-content:center;flex:1;min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;transition:all .3s ease}.mode-btn.active{background:#fc0;color:#1a2a6c}.mode-btn:hover{background:rgba(255,204,0,.3)}.main-content{display:flex;flex-direction:column;gap:16px}.exercise-section,.theory-section{background:rgba(255,255,255,.92);border-radius:12px;padding:16px;box-shadow:0 5px 15px rgba(0,0,0,.15)}.section-title{font-size:1.3rem;color:#1a2a6c;margin-bottom:12px;border-bottom:2px solid #1a2a6c;text-align:center;padding-bottom:8px;position:relative}.puzzle-container-wrapper{margin-top:18px;position:relative}.puzzle-container{display:flex;flex-wrap:wrap;gap:11px;margin:0;justify-content:center}.puzzle-slot{flex:0 0 auto;min-width:104px;max-width:138px;height:50px;border:2px dashed #1a2a6c;border-radius:8px;padding:2px;background:#f8f9fa;position:relative;text-align:center;display:flex;align-items:center;justify-content:center;margin-bottom:22px}.puzzle-slot.punctuation-slot{min-width:90px;max-width:120px}.puzzle-slot::before{content:attr(data-label);position:absolute;top:-24px;left:50%;transform:translateX(-50%);background:#1a2a6c;color:#fff;font-size:.8rem;padding:3px 8px;border-radius:8px;white-space:nowrap;z-index:10}.word-bank{display:flex;flex-wrap:wrap;gap:8px;margin:0;justify-content:center;min-height:70px;padding:9px 10px;background:rgba(0,0,0,.03);border-radius:8px;transition:background .3s}.word-bank.active{background:rgba(255,204,0,.1)}.puzzle-piece{background:#e3f2fd;padding:8px 12px;border-radius:6px;font-weight:700;cursor:move;min-width:70px;text-align:center;height:40px;display:flex;align-items:center;justify-content:center;font-size:.95rem;box-shadow:0 2px 4px rgba(0,0,0,.1);user-select:none;-webkit-tap-highlight-color:transparent;position:relative;transition:all .2s ease}.puzzle-piece:hover{transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.15)}.puzzle-slot>.puzzle-piece{width:100%;height:100%;display:flex;align-items:center;justify-content:center;padding:0;min-width:auto;box-shadow:none}.puzzle-piece.punctuation{background:#d7ccc8}.puzzle-piece.empty-slot{background:#e3f2fd;border:none}.puzzle-piece.empty-slot::after{content:""}.controls{display:flex;flex-wrap:wrap;justify-content:center;gap:8px;margin-top:16px;position:relative}.btn{padding:8px 14px;border-radius:8px;font-weight:700;cursor:pointer;border:none;display:flex;align-items:center;justify-content:center;transition:all .2s ease;font-size:.95rem;min-width:95px;flex:1;max-width:143px}.btn-secondary{background:#6c757d;color:#fff}.btn-secondary:hover{background:#5a6268}.btn-success{background:#28a745;color:#fff}.btn-success:hover{background:#218838}.btn-submit{background:#fc0;color:#1a2a6c;font-weight:700;min-width:132px;max-width:165px}.btn-submit:hover{background:#e6b800}.feedback{margin-top:16px;padding:12px;border-radius:8px;display:block;background:#d4edda;color:#155724;border:2px solid #c3e6cb;animation:fadeIn .5s ease}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.feedback-header{display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;margin-bottom:12px;gap:8px}.feedback-title{font-size:1.2rem;color:#1a2a6c;font-weight:700;flex:1;min-width:150px}.current-score-container{font-size:1.3rem;font-weight:700;min-width:100px;text-align:right}.current-score-container.high{color:#28a745}.current-score-container.low{color:#dc3545}.score-details{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:12px}.score-item{background:rgba(255,255,255,.7);padding:8px;border-radius:8px;text-align:center}.score-value{font-size:1.1rem;font-weight:700;color:#1a2a6c;display:block;margin-top:4px}.score-item.error .score-value{color:#dc3545}.reference-answer{text-align:center;font-size:1.1rem;font-weight:700;margin:12px 0;padding:8px;background:rgba(255,255,255,.7);border-radius:8px;border-left:4px solid #1a2a6c}.vocab-section{margin-bottom:8px;padding:2px;border-radius:8px}.vocab-container{display:flex;flex-wrap:wrap;gap:6px;justify-content:center}.vocab-item{background:#fff;padding:6px 10px;border-radius:5px;font-size:.9rem;font-weight:500;color:#1a2a6c;min-width:80px;text-align:center;box-shadow:0 1px 3px rgba(0,0,0,.1);flex:1;transition:transform .2s}.vocab-item:hover{transform:scale(1.05)}.copyright{text-align:center;font-size:.85rem;margin-top:20px;padding:10px 15px;background:rgba(255,255,255,.25);border-radius:8px;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.3);box-shadow:0 2px 6px rgba(0,0,0,.2)}.theory-card{background:#f8f9fa;border-radius:8px;padding:12px;margin-top:12px;border:1px solid #ddd;box-shadow:0 2px 5px rgba(0,0,0,.05);font-size:.95rem;width:100%}.theory-card ul{padding-left:20px;margin:12px 0}.theory-card li{margin-bottom:6px;line-height:1.5}.theory-card li li{font-size:.9em;line-height:1.4}.advanced-tip{position:fixed;top:70px;left:50%;transform:translateX(-50%);background:rgba(255,255,255,.9);color:#1a2a6c;padding:8px 16px;border-radius:30px;box-shadow:0 4px 10px rgba(0,0,0,.2);z-index:1000;opacity:0;transition:opacity .5s ease-in-out;pointer-events:none;font-weight:700;max-width:90%;text-align:center;font-size:.95rem}.advanced-tip.show{opacity:1}.btn-icon{margin-left:6px;font-size:1.05em}.sentence-info{display:flex;flex-wrap:wrap;justify-content:center;align-items:center;margin-bottom:0;padding:10px;background:#e3f2fd;border-radius:8px;font-size:1rem;font-weight:700;color:#1a2a6c;text-align:center}.translation-text{text-decoration:underline;text-decoration-thickness:1.5px;text-underline-offset:3px;margin-left:4px;font-weight:700;display:inline-block;margin-top:4px;flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis}.next-button-warning{position:absolute;top:-32px;left:50%;transform:translateX(-50%);background:#dc3545;color:#fff;padding:5px 12px;border-radius:20px;font-size:.85rem;opacity:0;transition:opacity .3s ease;white-space:nowrap;pointer-events:none;width:max-content;max-width:90%}.next-button-warning.show{opacity:1}.reading-indicator{display:flex;gap:6px;align-items:center;justify-content:center;margin-top:0;position:absolute;right:12px;top:calc(50% - 15px);transform:translateY(-50%);pointer-events:none;z-index:1001}.reading-dot{width:10px;height:10px;border-radius:50%;background:#bbb;transition:background .18s,box-shadow .18s}.reading-indicator.speaking .dot1{animation:dot1Anim 1.2s linear infinite}.reading-indicator.speaking .dot2{animation:dot2Anim 1.2s linear infinite}.reading-indicator.speaking .dot3{animation:dot3Anim 1.2s linear infinite}@keyframes dot1Anim{0%,100%{background:#4caf50;box-shadow:0 0 8px rgba(76,175,80,.95)}25%,50%,75%{background:#bbb;box-shadow:none}}@keyframes dot2Anim{25%,75%{background:#4caf50;box-shadow:0 0 8px rgba(76,175,80,.95)}0%,100%,50%{background:#bbb;box-shadow:none}}@keyframes dot3Anim{50%{background:#4caf50;box-shadow:0 0 8px rgba(76,175,80,.95)}0%,100%,25%,75%{background:#bbb;box-shadow:none}}.file-upload-container{background:rgba(255,255,255,.92);border-radius:12px;padding:16px;margin-top:16px;box-shadow:0 5px 15px rgba(0,0,0,.15)}.file-upload-header{display:flex;align-items:center;margin-bottom:12px;flex-wrap:wrap;gap:10px}.file-upload-btn{background:#1a2a6c;color:#fff;padding:8px 16px;border-radius:8px;cursor:pointer;font-weight:700;display:inline-flex;align-items:center;min-width:150px;justify-content:center;border:none;transition:background .2s}.file-upload-btn:hover{background:#0e1a4a}.file-upload-btn svg{margin-right:8px}.file-name{margin-left:12px;font-size:.9rem;color:#666;flex:1;min-width:200px}.upload-status{margin-top:12px;padding:10px;border-radius:8px;text-align:center;font-weight:700;display:none}.upload-status.success{background:#d4edda;color:#155724;border:1px solid #c3e6cb;display:block}.upload-status.error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb;display:block}.sentence-puzzle-header{position:relative;padding-bottom:6px}@media (max-width:767px){.puzzle-piece{cursor:pointer}.puzzle-slot.filled{cursor:pointer}.puzzle-slot.filled .puzzle-piece{transform:scale(1.05);box-shadow:0 0 10px rgba(0,0,0,.2)}.puzzle-slot.filled .puzzle-piece:hover{transform:scale(1.1);box-shadow:0 0 15px rgba(0,0,0,.3)}.mobile-tip{display:block;text-align:center;font-size:.9rem;color:#1a2a6c;background:rgba(255,255,255,.5);padding:6px;border-radius:8px;margin-top:8px}}@media (min-width:768px){.mobile-tip{display:none}}@media (min-width:768px){.container{padding:20px}header{flex-direction:row;align-items:flex-end;padding:0;margin-bottom:20px}.header-top{flex-direction:row;align-items:flex-end;margin-bottom:0}.header-title{margin-right:20px;max-width:calc(100% - 200px)}h1{font-size:1.8rem;max-width:100%}.tool-description{font-size:.95rem;padding:10px;max-height:none;-webkit-line-clamp:unset;max-width:100%}.mode-container{min-width:180px}.mode-title{font-size:1.05rem}.mode-btn{font-size:1rem;height:36px}.main-content{display:grid;grid-template-columns:1fr 350px;gap:20px}.section-title{font-size:1.5rem}.puzzle-container{justify-content:center;gap:11px}.puzzle-slot{min-width:115px;max-width:173px;margin-bottom:22px}.puzzle-slot.punctuation-slot{min-width:100px;max-width:150px}.score-details{grid-template-columns:repeat(4,1fr)}.sentence-info{text-align:left;justify-content:flex-start}.translation-text{margin-top:0;margin-left:5px}.file-upload-header{flex-wrap:nowrap}.header-left{max-width:calc(100% - 200px)}.tool-description{max-width:100%}}@media (min-width:992px){h1{font-size:2rem;max-width:100%}.mode-container{min-width:250px}h1{font-size:clamp(1.8rem, 3vw, 2rem);white-space:normal;overflow:visible;line-height:1.2}}.header-grid{display:grid;grid-template-columns:1fr auto;grid-template-areas:"left right";gap:15px;margin-bottom:20px;align-items:center}.header-left{grid-area:left;display:flex;flex-direction:column;gap:8px}.header-right{grid-area:right;display:flex;flex-direction:column;align-items:flex-end;gap:8px}.stats-section{background:rgba(255,255,255,.92);border-radius:12px;padding:16px;margin-top:16px;box-shadow:0 5px 15px rgba(0,0,0,.15)}.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}.stats-item{background:rgba(255,255,255,.7);padding:10px;border-radius:8px;text-align:center;font-weight:700;color:#1a2a6c}.stats-value{display:block;margin-top:5px;font-size:1.15rem}.corpus-section-compressed{background:rgba(255,255,255,.92);border-radius:12px;padding:12px;margin-top:16px;box-shadow:0 5px 15px rgba(0,0,0,.15)}.corpus-title-inline{font-size:1.5rem;color:#1a2a6c;font-weight:700;margin-bottom:8px;text-align:left}.file-upload-container{display:flex;flex-direction:column;gap:8px}.file-upload-row{display:flex;align-items:center;gap:12px;flex-wrap:wrap}.file-upload-btn{background:#1a2a6c;color:#fff;border:none;border-radius:8px;padding:8px 14px;font-weight:700;cursor:pointer}.file-name{color:#333;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:60%}.upload-status{font-size:.95rem;color:#555}.main-content{display:grid;grid-template-columns:2fr 1fr;gap:20px}@media (max-width:991px){.main-content{grid-template-columns:1fr}}.left-column{display:flex;flex-direction:column;gap:16px;min-height:100%}.stats-section{background:rgba(255,255,255,.92);border-radius:12px;padding:16px;box-shadow:0 5px 15px rgba(0,0,0,.15)}.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}.stats-item{background:rgba(255,255,255,.7);padding:10px;border-radius:8px;text-align:center;font-weight:700;color:#1a2a6c}.stats-value{display:block;margin-top:5px;font-size:1.1rem}.corpus-management-section{background:#f8f9fa;border-radius:8px;padding:16px;margin-top:16px;border:1px solid #ddd;box-shadow:0 2px 5px rgba(0,0,0,.05)}.corpus-header{font-size:1.2rem;color:#1a2a6c;font-weight:700;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid #ddd}.upload-row{display:flex;flex-wrap:wrap;align-items:center;gap:12px}.upload-controls{display:flex;align-items:center;gap:12px;flex:1;min-width:200px}.upload-status-container{flex:1;min-width:50%;text-align:right}.corpus-hint{font-size:.85rem;color:#666;flex:1;min-width:100%;padding:8px;background:rgba(255,255,255,.7);border-radius:6px;text-align:center;width:350px}@media (min-width:768px){.upload-row{flex-wrap:nowrap;align-items:center}.upload-controls{flex:2}.upload-status-container{flex:1;min-width:0;align-self:stretch;display:flex;align-items:center;justify-content:flex-end}.corpus-hint{min-width:0;flex:3;text-align:right;align-self:stretch;display:flex;align-items:center;justify-content:center;padding-right:20px}.upload-status{margin-top:0;width:100%;text-align:right}}.puzzle-container.simple-mode .puzzle-slot{min-width:104px!important;max-width:138px!important;flex:0 0 calc(33.333% - 15px)!important}@media (max-width:767px){.puzzle-container.simple-mode .puzzle-slot{min-width:104px!important;max-width:138px!important}}.puzzle-slot:empty::after{content:"↓ 放置位置";color:#999;font-size:.7rem;font-style:italic;position:absolute;top:50%;left:0;right:0;transform:translateY(-50%);text-align:center}.empty-state{text-align:center;padding:16px;background:rgba(255,255,255,.8);border-radius:8px;margin:10px 0;display:none}.empty-state.show{display:block}.empty-state p{margin-bottom:10px;font-weight:700;color:#1a2a6c}.guide-animation{font-size:2rem;animation:bounce 1.5s infinite}@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.loading-spinner{display:inline-block;width:16px;height:16px;border:3px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;animation:spin 1s ease-in-out infinite;margin-right:8px}.initial-hint{text-align:center;padding:20px;color:#666;font-style:italic}@media (prefers-reduced-motion:reduce){*{transition:none!important;animation:none!important}}</style><div class="container"><div class="advanced-tip" id="advancedTip">提示：进阶模式下有部分拼图不需要</div><header class="header-grid"><div class="header-left"><h1>至元德语 - 造句练习器 A1-1</h1><p class="tool-description">完成拼图，掌握德语四大句型和动词第二位规律</div><div class="header-right"><div class="mode-title">句型和动词的位置练习</div><div class="mode-selector"><div class="mode-btn active" id="simpleModeBtn">简单模式</div><div class="mode-btn" id="advancedModeBtn">进阶模式</div></div></div><div aria-hidden="true" class="reading-indicator" id="readingIndicator"><div class="reading-dot dot1"></div><div class="reading-dot dot2"></div><div class="reading-dot dot3"></div></div></header><div class="main-content"><div class="left-column"><section class="exercise-section"><div class="sentence-puzzle-header"><h2 class="section-title">句型拼图练习</h2></div><div class="sentence-info">中文：<span class="translation-text" id="currentTranslation">请上传语料库开始练习</span></div><div class="empty-state" id="emptyState"><p>请从下方词汇区拖拽单词到句子框架中<div class="guide-animation">↓</div></div><div class="puzzle-container-wrapper"><div class="puzzle-container" id="puzzleContainer"><div class="puzzle-slot" data-label="第1位" id="slot1"></div><div class="puzzle-slot" data-label="第2位" id="slot2"></div><div class="puzzle-slot" data-label="其他位" id="slot3"></div><div class="puzzle-slot punctuation-slot" data-label="标点" id="slot4"></div></div></div><div class="word-bank" id="wordBank"></div><div class="controls"><button class="btn btn-secondary" id="resetBtn">重置拼图</button> <button class="btn btn-submit" id="submitBtn">提交答案 <span class="btn-icon">💡</span></button> <button class="btn btn-success" id="nextBtn">下一题</button><div class="next-button-warning" id="nextButtonWarning">请先提交答案，再进行下一题！</div></div><div class="feedback" id="feedback"><div class="feedback-header"><h3 class="feedback-title">评价及解析</h3><div class="current-score-container" id="currentScoreContainer">得分：<span id="currentScore">0</span> / <span id="maxScore">5</span></div></div><div class="reference-answer">参考答案: <span id="referenceAnswer"></span></div><div class="score-details"><div class="score-item"><div>第1位</div><div class="score-value" id="slot1Score">0</div></div><div class="score-item"><div>第2位</div><div class="score-value" id="slot2Score">0</div></div><div class="score-item"><div>其他位</div><div class="score-value" id="slot3Score">0</div></div><div class="score-item"><div>标点</div><div class="score-value" id="slot4Score">0</div></div></div><div class="initial-hint" id="initialHint">完成练习后，这里会显示答案解析和得分</div></div></section><section class="stats-section"><div class="stats-grid"><div class="stats-item">完成题数<span class="stats-value" id="totalCompleted">0</span></div><div class="stats-item">正确率<span class="stats-value" id="accuracy">0%</span></div><div class="stats-item">高频错误<span class="stats-value" id="topErrors">-</span></div><div class="stats-item">剩余答题数<span class="stats-value" id="remainingQuestions">0</span></div></div></section></div><section class="theory-section"><h2 class="section-title">练习要点</h2><div style="margin-top:10px"><h3 style="color:#1a2a6c">练习词汇表</h3><div id="vocabContainer"></div></div><div style="margin-top:16px"><h3 style="color:#1a2a6c">语法小贴士</h3><div class="theory-card"><ul><li>第1位先确定句型，再选择内容<li>四大句型和第1位的关系:<ul><li>陈述句的第1位通常是主语或其他<li>W-疑问句第1位是W-疑问词<li>命令句和Ja/Nein疑问句第1位空缺</ul><li>始终注意动词的位置 - 必须在第二位</ul></div></div></section></div><section class="corpus-management-section"><div class="corpus-header">语料库管理</div><div class="upload-row"><div class="upload-controls"><button class="file-upload-btn" id="uploadBtn"><svg fill="none" height="20" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="20" aria-hidden="true"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" x2="12" y1="3" y2="15"></line></svg> 上传本地语料</button> <button class="file-upload-btn" id="fetchJsonBtn" style="background:#2a6c1a"><svg fill="white" height="20" viewBox="0 0 24 24" width="20" aria-hidden="true"><path d="M12 21c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm6-7h-1.7c0 3-2.5 5.1-5.3 5.1S6.7 17 6.7 14H5c0 3.4 2.7 6.2 6 6.7V23h2v-2.3c3.3-.5 6-3.3 6-6.7zm-9-9.9V1h2v3.1c3.4.5 6 3.3 6 6.7h-1.7c0-3-2.5-5.1-5.3-5.1S6.7 7 6.7 10H5c0-3.4 2.7-6.2 6-6.7z"/></svg> 获取云端语料</button> <input type="file" id="corpusFile" accept=".json" style="display:none"> <span class="file-name" id="fileName">未选择文件</span></div><div class="upload-status-container"><div class="upload-status" id="uploadStatus"></div></div><div class="corpus-hint">请选择本地上传或云端加载语料库json</div></div></section><div class="copyright">© 2025 至元德语原创开发，仅供内部学生使用，未经书面许可禁止复制、传播或商用。</div><script>const AppConfig={REMOTE_URL:"https://zydeutsch-chen.github.io/ZYDetusch-model/A1-1sentences-encrypted.json",exerciseType:"A1-1",slots:{labels:["第1位","第2位","其他位","标点"],scoring:{simple:{slot1:2,slot2:2,slot3:1},advanced:{slot1:1.5,slot2:2,slot3:1,slot4:.5}}},vocabCategories:[{id:"questionWords",name:"疑问词",color:"#ffcc80"},{id:"verbs",name:"动词",color:"#a5d6a7"},{id:"subjects",name:"主语",color:"#90caf9"},{id:"others",name:"其他",color:"#f48fb1"}],uiStrings:{chinese:{uploadHint:"请选择本地上传或云端加载语料库json",emptyStateText:"请从下方词汇区拖拽单词到句子框架中",nextButtonWarning:"请先提交答案，再进行下一题！",advancedTip:"提示：进阶模式下有部分拼图不需要"}}},Decryptor={_encoder:new TextEncoder,_decoder:new TextDecoder,decryptCorpusIfNeeded(e){try{if("object"==typeof e)return e;const t=(e||"").trim();if(t.startsWith("{")||t.startsWith("["))return JSON.parse(t);const o="et";let n=t;n.endsWith(o)&&(n=n.slice(0,-o.length));let s=n.replace(/^data:[^;]+;base64,/,"").replace(/[\s\n]/g,"").replace(/-/g,"+").replace(/_/g,"/");const r=s.length%4;r&&(s+="=".repeat(4-r));const l=atob(s),a=new Uint8Array(l.length);for(let e=0;e<l.length;e++)a[e]=l.charCodeAt(e);const c=this.xorWithKey(a,"ZY-secret"),d=this._decoder.decode(c);return JSON.parse(d)}catch(e){throw console.error("解密失败:",e),new Error(`解密失败: ${e.message}`)}},xorWithKey(e,t){const o=this._encoder.encode(t),n=new Uint8Array(e.length);for(let t=0;t<e.length;t++)n[t]=e[t]^o[t%o.length];return n}},RemoteLoader={async loadRemoteCorpus(){const e=document.getElementById("uploadStatus"),t=document.getElementById("fetchJsonBtn"),o=t.innerHTML;try{e.textContent="正在连接服务器...",e.className="upload-status",e.style.display="block",t.disabled=!0,t.innerHTML='<div class="loading-spinner"></div>获取中...';const o=await fetch(AppConfig.REMOTE_URL);if(!o.ok)throw new Error(`网络错误: ${o.status} ${o.statusText}`);const n=await o.text();e.textContent="正在解密数据...";const s=Decryptor.decryptCorpusIfNeeded(n);if(!s.sentences||!Array.isArray(s.sentences))throw new Error("无效的语料库格式: 缺少句子数据");if(!s.vocabulary||"object"!=typeof s.vocabulary)throw new Error("无效的语料库格式: 缺少词汇表数据");return e.textContent="语料库加载成功！",e.className="upload-status success",s}catch(t){throw console.error("加载远程语料库失败:",t),e.textContent=`错误: ${t.message}`,e.className="upload-status error",t}finally{t.innerHTML=o,t.disabled=!1}}},Model=(()=>{let e=[],t={questionWords:new Set,verbs:new Set,subjects:new Set,others:new Set,punctuation:new Set([".","?"])},o={totalCompleted:0,perfectCount:0,errorCounts:{slot1:0,slot2:0,slot3:0},answeredCount:0,totalErrors:0,totalQuestions:0},n=new Set;return{sentences:e,vocabulary:t,statistics:o,loadCorpus:s=>{if(!s.sentences||!Array.isArray(s.sentences))throw new Error("无效的语料库格式: 缺少句子数据");return e=s.sentences.map(e=>{const t={...e.parts};return Object.keys(t).forEach(e=>{"空缺"===t[e]&&(t[e]="")}),{...e,parts:t}}),t.questionWords=new Set(s.vocabulary?.questionWords||[]),t.verbs=new Set(s.vocabulary?.verbs||[]),t.subjects=new Set(s.vocabulary?.subjects||[]),t.others=new Set(s.vocabulary?.others||[]),t.punctuation=new Set(s.vocabulary?.punctuation||[".","?"]),n=new Set,o.totalQuestions=e.length,!0},getRandomSentence:()=>{if(0===e.length)return{parts:{slot1:"",slot2:"",slot3:"",slot4:""},full:"请上传语料库",translation:"请上传语料库开始练习",weight:1};if(n.size>=50||n.size===e.length)return{parts:{slot1:"",slot2:"",slot3:"",slot4:""},full:"恭喜你，你已完成所有练习！",translation:"恭喜你，你已完成所有练习！",weight:1,isCompleted:!0};const t=[];e.forEach((e,o)=>{n.has(o)||t.push(o)});const o=t.reduce((t,o)=>t+e[o].weight,0);let s=Math.random()*o;for(const o of t)if(s-=e[o].weight,s<=0)return n.add(o),e[o];return e[t[0]]},updateStatistics:(e,t)=>{o.totalCompleted+=1,o.answeredCount+=1,e.total<5&&(o.totalErrors+=1),5===e.total&&(o.perfectCount+=1);const{scores:n}=e;n.slot1<(t?1.5:2)&&(o.errorCounts.slot1+=1),n.slot2<2&&(o.errorCounts.slot2+=1),n.slot3<1&&(o.errorCounts.slot3+=1)},getStatistics:()=>o,getVocabulary:()=>t}})(),Speech=(()=>{let e=!1,t=!1,o=null,n=null,s=!1,r="";const l=()=>{const e=window.speechSynthesis.getVoices();o=e.find(e=>e.lang.includes("zh")&&e.name.toLowerCase().includes("female"))||e.find(e=>e.lang.includes("zh"))||null,n=e.find(e=>("de-DE"===e.lang||"de-CH"===e.lang||"de"===e.lang)&&e.name.toLowerCase().includes("male"))||e.find(e=>e.lang.includes("de"))||null},a=()=>{if(e){if(!s){if(0===window.speechSynthesis.getVoices().length)return void(window.speechSynthesis.onvoiceschanged=()=>{s=!0,l()});s=!0}l()}};return document.addEventListener("click",()=>{e||(e=!0,a())}),{speakChinese:n=>{if(!e)return;if(r===n)return;if(!o&&(a(),!o))return;t&&window.speechSynthesis.cancel();const s=new SpeechSynthesisUtterance(n);s.voice=o||null,s.lang=o&&o.lang||"zh-CN",s.rate=.9;const l=document.getElementById("readingIndicator");l&&l.classList.add("speaking"),t=!0,s.onend=()=>{l&&l.classList.remove("speaking"),t=!1,r=n},window.speechSynthesis.speak(s)},speakGerman:o=>{if(!e)return;if(!n&&(a(),!n))return;t&&window.speechSynthesis.cancel();const s=new SpeechSynthesisUtterance(o);s.voice=n||null,s.lang=n&&n.lang||"de-DE",s.rate=.9;const r=document.getElementById("readingIndicator");r&&r.classList.add("speaking"),t=!0,s.onend=()=>{r&&r.classList.remove("speaking"),t=!1},window.speechSynthesis.speak(s)}}})(),Algorithm={getDistractorWords:e=>{const t=(()=>{const e=new Set;return Model.vocabulary.questionWords.forEach(t=>e.add(t)),Model.vocabulary.verbs.forEach(t=>e.add(t)),Model.vocabulary.subjects.forEach(t=>e.add(t)),Model.vocabulary.others.forEach(t=>e.add(t)),Model.vocabulary.punctuation.forEach(t=>e.add(t)),e})();return Object.values(e.parts).forEach(e=>t.delete(e)),t.delete("."),t.delete("?"),t.delete(""),Array.from(t)},calculateScore:(e,t,o)=>{const n={slot1:0,slot2:0,slot3:0,slot4:0};if(e.slot1===t.slot1&&(n.slot1=o?AppConfig.slots.scoring.advanced.slot1:AppConfig.slots.scoring.simple.slot1),e.slot2===t.slot2&&(n.slot2=o?AppConfig.slots.scoring.advanced.slot2:AppConfig.slots.scoring.simple.slot2),o)e.slot3===t.slot3&&(n.slot3=AppConfig.slots.scoring.advanced.slot3),e.slot4===t.slot4&&(n.slot4=AppConfig.slots.scoring.advanced.slot4);else{const o=(t.slot3||"")+(t.slot4||"");e.slot3===o&&(n.slot3=AppConfig.slots.scoring.simple.slot3)}const s=Object.values(n).reduce((e,t)=>e+t,0);return{scores:n,total:Math.round(10*s)/10}}},MobileClick=(()=>{let e=!1;const t=t=>{if(!e)return;const o=t.target.closest(".puzzle-piece");if(!o)return;const s=[document.getElementById("slot1"),document.getElementById("slot2"),document.getElementById("slot3"),document.getElementById("slot4")].find(e=>!e.firstChild);s&&n(o,s)},o=t=>{if(!e)return;const o=t.target.closest(".puzzle-slot");o&&o.firstChild&&s(o)},n=(e,t)=>{const o=e.cloneNode(!0);UI.isAdvancedMode&&t.id===UI.currentFirstInitialSlot&&o.textContent&&(o.textContent=o.textContent.charAt(0).toUpperCase()+o.textContent.slice(1)),t.appendChild(o),e.remove(),t.classList.add("filled")},s=e=>{const t=e.firstChild;let o=t.textContent;UI.isAdvancedMode&&e.id===UI.currentFirstInitialSlot&&o&&(o=o.charAt(0).toLowerCase()+o.slice(1)),t.textContent=o,document.getElementById("wordBank").appendChild(t),e.classList.remove("filled")};return{initClickSelection:()=>{if(!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return;e=!0,document.getElementById("wordBank").addEventListener("click",t,{passive:!0}),document.getElementById("puzzleContainer").addEventListener("click",o,{passive:!0});const n=document.createElement("div");n.className="mobile-tip",n.textContent="提示：点击单词填充到句子中，点击句子中的单词可移除",document.querySelector(".puzzle-container-wrapper").appendChild(n)}}})(),UI=(()=>{const e={slot1:document.getElementById("slot1"),slot2:document.getElementById("slot2"),slot3:document.getElementById("slot3"),slot4:document.getElementById("slot4"),wordBank:document.getElementById("wordBank"),feedback:document.getElementById("feedback"),referenceAnswer:document.getElementById("referenceAnswer"),currentTranslation:document.getElementById("currentTranslation"),slot1Score:document.getElementById("slot1Score"),slot2Score:document.getElementById("slot2Score"),slot3Score:document.getElementById("slot3Score"),slot4Score:document.getElementById("slot4Score"),currentScore:document.getElementById("currentScore"),maxScore:document.getElementById("maxScore"),currentScoreContainer:document.getElementById("currentScoreContainer"),simpleModeBtn:document.getElementById("simpleModeBtn"),advancedModeBtn:document.getElementById("advancedModeBtn"),resetBtn:document.getElementById("resetBtn"),submitBtn:document.getElementById("submitBtn"),nextBtn:document.getElementById("nextBtn"),advancedTip:document.getElementById("advancedTip"),nextButtonWarning:document.getElementById("nextButtonWarning"),readingIndicator:document.getElementById("readingIndicator"),uploadBtn:document.getElementById("uploadBtn"),corpusFile:document.getElementById("corpusFile"),fileName:document.getElementById("fileName"),uploadStatus:document.getElementById("uploadStatus"),totalCompleted:document.getElementById("totalCompleted"),accuracy:document.getElementById("accuracy"),topErrors:document.getElementById("topErrors"),remainingQuestions:document.getElementById("remainingQuestions"),puzzleContainer:document.getElementById("puzzleContainer"),vocabContainer:document.getElementById("vocabContainer"),emptyState:document.getElementById("emptyState"),fetchJsonBtn:document.getElementById("fetchJsonBtn"),initialHint:document.getElementById("initialHint"),scoreDetailsEl:document.querySelector(".score-details"),referenceAnswerEl:document.querySelector(".reference-answer"),feedbackHeaderEl:document.querySelector(".feedback-header")};let t=!1,o=!1,n=!1,s=null,r=null,l="slot1";const a=()=>{[e.slot1,e.slot2,e.slot3,e.slot4].forEach(o=>{o.addEventListener("touchmove",function(e){e.preventDefault()},{passive:!1}),o.addEventListener("touchend",function(o){if(!r)return;o.preventDefault(),this.firstChild&&e.wordBank.appendChild(this.firstChild),this.innerHTML="";const n=r.cloneNode(!0);t&&this.id===l&&n.textContent&&(n.textContent=n.textContent.charAt(0).toUpperCase()+n.textContent.slice(1)),this.appendChild(n),r.remove(),r=null},{passive:!1}),o.ondragover=e=>e.preventDefault(),o.ondrop=n=>{let s;n.preventDefault();try{s=JSON.parse(n.dataTransfer.getData("application/json"))}catch{return}o.firstChild&&e.wordBank.appendChild(o.firstChild),o.innerHTML="";const r=document.createElement("div");r.className="puzzle-piece","."!==s.text&&"?"!==s.text||r.classList.add("punctuation");let a=s.text;t&&o.id===l&&a&&(a=a.charAt(0).toUpperCase()+a.slice(1)),r.textContent=a,r.draggable=!0,r.dataset.correctSlot=s.correctSlot,o.appendChild(r);const c=[...e.wordBank.children];for(let e=0;e<c.length;e++)if(c[e].textContent===s.text){c[e].remove();break}}})},c=()=>{e.vocabContainer.innerHTML="";const t=Model.getVocabulary();AppConfig.vocabCategories.forEach(o=>{const n=t[o.id];if(!n||0===n.size)return;const s=document.createElement("div");s.className="vocab-block",s.style.backgroundColor=o.color,s.style.padding="10px",s.style.borderRadius="8px",s.style.marginBottom="12px";const r=document.createElement("strong");r.textContent=o.name,s.appendChild(r);const l=document.createElement("div");l.className="vocab-container",n.forEach(e=>{if(""===e)return;const t=document.createElement("span");t.className="vocab-item",t.textContent=e,l.appendChild(t)}),s.appendChild(l),e.vocabContainer.appendChild(s)})},d=()=>{const t=Model.statistics;e.totalCompleted.textContent=t.totalCompleted;const o=t.totalCompleted>0?(t.perfectCount/t.totalCompleted*100).toFixed(0):0;if(e.accuracy.textContent=`${o}%`,t.totalErrors>=3){const o=Object.entries(t.errorCounts).sort((e,t)=>{if(t[1]!==e[1])return t[1]-e[1];const o={slot1:1,slot2:2,slot3:3};return o[e[0]]-o[t[0]]}).slice(0,2).map(e=>"slot1"===e[0]?"1位":"slot2"===e[0]?"2位":"其他位");e.topErrors.textContent=o.join(" ")||"无"}else e.topErrors.textContent="-";e.remainingQuestions.textContent=Math.max(0,(Model.sentences?.length||50)-t.answeredCount)},i=a=>{if([e.slot1,e.slot2,e.slot3,e.slot4].forEach(e=>e.innerHTML=""),e.wordBank.innerHTML="",s=a,a.isCompleted)return e.currentTranslation.textContent=a.translation,e.wordBank.innerHTML='<div class="puzzle-piece" style="background:#4CAF50;color:white;">练习已完成</div>',e.nextBtn.disabled=!0,void(e.submitBtn.disabled=!0);e.nextBtn.disabled=!1,e.submitBtn.disabled=!1;let c=[];if(t){c.push({text:a.parts.slot1,correctSlot:"slot1"},{text:a.parts.slot2,correctSlot:"slot2"},{text:a.parts.slot3,correctSlot:"slot3"});const e=[".","?"],t=a.parts.slot4,o=e.find(e=>e!==t);c.push({text:t,correctSlot:"slot4"},{text:o,correctSlot:"none"});const n=Algorithm.getDistractorWords(a);n.length>0&&c.push({text:n[Math.floor(Math.random()*n.length)],correctSlot:"none"});const s=[a.parts.slot1,a.parts.slot2,a.parts.slot3].some(e=>""===e),r=c.some(e=>""===e.text);s||r||c.push({text:"",correctSlot:"none"}),l=""!==a.parts.slot1?"slot1":""!==a.parts.slot2?"slot2":"slot3"}else c=[{text:a.parts.slot1||"",correctSlot:"slot1"},{text:a.parts.slot2||"",correctSlot:"slot2"},{text:(a.parts.slot3||"")+(a.parts.slot4||""),correctSlot:"slot3"}];c.sort(()=>Math.random()-.5),c.forEach(o=>{const n=document.createElement("div");n.className="puzzle-piece","."!==o.text&&"?"!==o.text||n.classList.add("punctuation");let s=o.text;if(t&&void 0!==l&&o.correctSlot===l&&s){const e=s.match(/^([A-Za-zÄÖÜäöüß]+)/u),t=e?e[1]:"",o=t.toLowerCase(),n=new Set(["ich","du","er","sie","es","wir","ihr"]),r=Model.vocabulary?.questionWords&&Model.vocabulary.questionWords.has(o),l=Model.vocabulary?.verbs&&Model.vocabulary.verbs.has(o);let a=n.has(o)||"mein"===o||r||l;"Sie"===t&&(a=!1),a&&(s=s.replace(/^(\p{L})/u,e=>e.toLowerCase()))}n.textContent=s,n.draggable=!0,n.dataset.correctSlot=o.correctSlot,e.wordBank.appendChild(n),n.addEventListener("touchstart",function(e){e.preventDefault(),r=n,this.classList.add("dragging")},{passive:!1}),n.addEventListener("touchend",function(){this.classList.remove("dragging"),r=null},{passive:!0}),n.ondragstart=e=>{try{e.dataTransfer.setData("application/json",JSON.stringify(o)),e.dataTransfer.effectAllowed="move"}catch(e){}}}),e.referenceAnswer.textContent=a.full,e.currentTranslation.textContent=a.translation,c.length>0?e.emptyState.classList.remove("show"):(e.emptyState.querySelector("p").textContent=AppConfig.uiStrings.chinese.emptyStateText,e.emptyState.classList.add("show")),o=!1,n=!1,e.initialHint.style.display="block",e.scoreDetailsEl.style.display="none",e.referenceAnswerEl.style.display="none",e.feedbackHeaderEl.style.display="none",setTimeout(()=>{Speech.speakChinese(a.translation)},500)},u=()=>{c(),s=Model.getRandomSentence(),i(s),d()};return{initUI:()=>{t=!1,e.slot4.style.display="none",e.puzzleContainer.classList.add("simple-mode"),e.emptyState.querySelector("p").textContent=AppConfig.uiStrings.chinese.emptyStateText,c(),s=Model.getRandomSentence(),i(s),a(),e.uploadBtn.addEventListener("click",()=>e.corpusFile.click(),{passive:!0}),e.corpusFile.addEventListener("change",function(t){const o=t.target.files[0];if(!o)return;e.fileName.textContent=o.name,e.uploadStatus.textContent="正在加载语料库...",e.uploadStatus.className="upload-status",e.uploadStatus.style.display="block";const n=new FileReader;n.onload=function(t){try{const o=t.target.result,n=Decryptor.decryptCorpusIfNeeded(o);if(!n.sentences||!Array.isArray(n.sentences))throw new Error("无效的语料库格式: 缺少句子数据");Model.loadCorpus(n),e.uploadStatus.textContent="语料库加载成功！",e.uploadStatus.className="upload-status success",u()}catch(t){e.uploadStatus.textContent="加载失败: "+t.message,e.uploadStatus.className="upload-status error",console.error("语料库加载错误:",t)}},n.onerror=function(){e.uploadStatus.textContent="文件读取失败",e.uploadStatus.className="upload-status error"},n.readAsText(o)}),e.fetchJsonBtn.addEventListener("click",async()=>{try{const t=await RemoteLoader.loadRemoteCorpus();Model.loadCorpus(t),e.fileName.textContent="云端语料库",u(),setTimeout(()=>{alert("云端语料库加载成功！已加载"+Model.sentences.length+"个句子")},300)}catch(e){}}),d(),window.UI={isAdvancedMode:t,currentFirstInitialSlot:l},e.simpleModeBtn.addEventListener("click",()=>{t=!1,window.UI.isAdvancedMode=!1,e.simpleModeBtn.classList.add("active"),e.advancedModeBtn.classList.remove("active"),e.slot4.style.display="none",e.puzzleContainer.classList.add("simple-mode"),s=Model.getRandomSentence(),i(s)}),e.advancedModeBtn.addEventListener("click",()=>{t=!0,window.UI.isAdvancedMode=!0,e.advancedModeBtn.classList.add("active"),e.simpleModeBtn.classList.remove("active"),e.slot4.style.display="block",e.puzzleContainer.classList.remove("simple-mode"),s=Model.getRandomSentence(),i(s),e.advancedTip.textContent=AppConfig.uiStrings.chinese.advancedTip,e.advancedTip.classList.add("show"),setTimeout(()=>{e.advancedTip.classList.remove("show")},3e3)}),e.resetBtn.addEventListener("click",()=>i(s)),e.nextBtn.addEventListener("click",()=>{if(!o&&!n)return e.nextButtonWarning.textContent=AppConfig.uiStrings.chinese.nextButtonWarning,e.nextButtonWarning.classList.add("show"),setTimeout(()=>{e.nextButtonWarning.classList.remove("show")},2e3),void(n=!0);s=Model.getRandomSentence(),i(s)}),e.submitBtn.addEventListener("click",()=>{if(s.isCompleted)return;const n={slot1:e.slot1.firstChild?.textContent||"",slot2:e.slot2.firstChild?.textContent||"",slot3:e.slot3.firstChild?.textContent||"",slot4:e.slot4.firstChild?.textContent||""};(n=>{const{scores:r,total:l}=n;e.slot1Score.textContent=r.slot1,e.slot2Score.textContent=r.slot2,e.slot3Score.textContent=r.slot3,e.slot4Score.textContent=t?r.slot4:"-",e.currentScore.textContent=l,e.maxScore.textContent=5,e.currentScoreContainer.classList.remove("high","low"),e.currentScoreContainer.classList.add(l>=4?"high":"low"),e.feedback.style.display="block",e.scoreDetailsEl.style.display="grid",e.referenceAnswerEl.style.display="block",e.feedbackHeaderEl.style.display="flex",e.initialHint.style.display="none",document.querySelectorAll(".score-item").forEach(e=>e.classList.remove("error")),t?(r.slot1<AppConfig.slots.scoring.advanced.slot1&&e.slot1Score.parentNode.classList.add("error"),r.slot2<AppConfig.slots.scoring.advanced.slot2&&e.slot2Score.parentNode.classList.add("error"),r.slot3<AppConfig.slots.scoring.advanced.slot3&&e.slot3Score.parentNode.classList.add("error"),r.slot4<AppConfig.slots.scoring.advanced.slot4&&e.slot4Score.parentNode.classList.add("error")):(r.slot1<AppConfig.slots.scoring.simple.slot1&&e.slot1Score.parentNode.classList.add("error"),r.slot2<AppConfig.slots.scoring.simple.slot2&&e.slot2Score.parentNode.classList.add("error"),r.slot3<AppConfig.slots.scoring.simple.slot3&&e.slot3Score.parentNode.classList.add("error")),o=!0,Model.updateStatistics(n,t),d(),5===l&&Speech.speakGerman(s.full)})(Algorithm.calculateScore(n,s.parts,t))}),document.addEventListener("drop",e=>e.preventDefault(),!1),document.addEventListener("dragover",e=>e.preventDefault(),!1)}}})();document.addEventListener("DOMContentLoaded",()=>{UI.initUI(),document.getElementById("wordBank").addEventListener("click",function(){this.classList.add("active"),setTimeout(()=>this.classList.remove("active"),300)},{passive:!0}),MobileClick.initClickSelection()})</script></div>